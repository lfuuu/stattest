<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/ui/i18n/jquery.ui.datepicker-ru.js"></script>
<link href="css/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css"/>

<h2>Отчет по ТехПоддержке{if $date} {$date}{/if}</h2>
<style>
{literal}
#repart_table td {
padding: 2px 2px 2px 2px;
}
#tr_head td {
font-weight: bold;
text-align: center;
{/literal}
</style>

<form action="" method=get>
	<input type="hidden" name="module" value="stats" />
	<input type="hidden" name="action" value="support_efficiency" />
	<table>
		<tr>
			<td>С</td>
			<td><input type=text name="date_from" value="{$date_from}" id="date_from"></td>
			<td>&nbsp;</td>
			<td>по</td>
			<td><input type=text name="date_to" value="{$date_to}" id="date_to"></td>
            <td><input type=submit value="OK" name="make_report"></td>
		</tr>
        <tr>
            <td colspan=2>Услуги в траблах:</td>
            <td colspan=4>{html_checkboxes name=usage options=$usages selected=$usages_selected separator="<br>"}</td>
        </tr>
    </table>
</form>

<script>
{literal}

$('#date_from').datepicker({
    dateFormat: 'yy-mm-dd',
    onClose: function(dateText, inst) {
        var endDateTextBox = $('#date_to');
        if (endDateTextBox.val() != '') {
            var testStartDate = new Date(dateText);
            var testEndDate = new Date(endDateTextBox.val());
            if (testStartDate > testEndDate)
            endDateTextBox.val(dateText);
        } else {
            endDateTextBox.val(dateText);
        }
    },
    onSelect: function (selectedDateTime){
        var start = $(this).datepicker('getDate');
        $('#date_to').datepicker('option', 'minDate', new Date(start.getTime()));
    }
});

$('#date_to').datepicker({
    dateFormat: 'yy-mm-dd',
    onClose: function(dateText, inst) {
        var startDateTextBox = $('#date_from');
        if (startDateTextBox.val() != '') {
            var testStartDate = new Date(startDateTextBox.val());
            var testEndDate = new Date(dateText);
            if (testStartDate > testEndDate)
                startDateTextBox.val(dateText);
        } else {
            startDateTextBox.val(dateText);
        }
    },
    onSelect: function (selectedDateTime){
        var end = $(this).datepicker('getDate');
        $('#date_from').datepicker('option', 'maxDate', new Date(end.getTime()) );
    }
});

{/literal}

</script>

<table id=repart_table border=1 style="border-collapse: collapse; border-color: #ccc;" cellspacing=2 >
<tr id="tr_head">
<td>#</td>
<td>ФИО</td>
<td>Консультаций</td>
<td>Мониторинг</td>
<td>Траблы</td>
<td>Задания</td>
<td>Всего</td>
</tr>
{foreach from=$d item=i key=idx}
<tr>
<td>{$i.count+1}.</td>
<td>{$i.name} <sup>({$idx})</sup></td>
<td>{$i.data.consultation.count}</td>
<td>{$i.data.monitoring.count}</td>
<td>{$i.data.trouble.count}{if $i.data.trouble.rating_count > 0} / <font style="color: {if $i.data.trouble.rating_avg <=3}#c40000{else}green{/if}">{$i.data.trouble.rating_avg|round:1}<sup>({$i.data.trouble.rating_count})</sup></font>{/if}</td>
<td>{$i.data.task.count}</td>
<td><i>{$i.data.trouble.count+$i.data.monitoring.count+$i.data.consultation.count+$i.data.task.count}</i></td>
</tr>
{/foreach}
<td colspan=2 align=right><b>Итого:</b>&nbsp;</td>
<td><b>{$total.consultation}</b></td>
<td><b>{$total.monitoring}</b></td>
<td><b>{$total.trouble}</b></td>
<td><b>{$total.task}</b></td>
<td><b><i>{$total.trouble+$total.monitoring+$total.consultation+$total.task}</i></b></td>
</tr>
</table>

