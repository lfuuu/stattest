{if $view == "number"}<h1>Учетные записи SIP</h1>
    {*if $client && $isAllowAdd}
        <a href="./?module=ats&action=sip_add"><img align=absmiddle src="./images/icons/add.gif">Добавить</a>
    {/if*}
{/if}
<form action="./?module=ats&action=sip_action" method=post>
<script>
var sipAllChecked = false;
</script>
<input type=hidden name=super_id value={if $data.s_id}{$data.s_id}{else}0{/if}>

<style>
{literal}
th{
font: bold 8pt sans-serif;
}
{/literal}
</style>

{if $view == "number"}
<table width=100% border=1 style="border-collapse:collapse;" id="sip_table">
<tr>
<th colspan=3>Номер</th>
<th colspan=5>SIP-account</th>
</tr>
<tr>
<th>Номер</th>
<th>Одноврем. звонков</th>
<th>Направление</th>
<th>Логин</th>
<th>Тип</th>
<th>Одновр. звонков</th>
<th align=center><input type=checkbox style="padding: 0 0 0 0;margin: 0 0 0 0;" onclick="$('#sip_table input[type=checkbox]').each({literal}function (i,o){if(i>0){o.checked=sipAllChecked;}else{sipAllChecked = o.checked}}){/literal}"></th>
</tr>

{foreach from=$s1 item=n}

<tr {if $n.enabled == "no"}style="text-decoration: line-through; color: gray;"{/if}>
<td><div{if $i.enabled=="no"} style="color: grey;text-decoration: line-through;"{/if}>{$n.n_number}</div></td>
<td>{$n.n_call_count}</td>
<td>{$n.direction}</td>
{if !$n.is_number}
<td{if $n.count && $n.count > 1} rowspan={$n.count}{/if}><a {if $n.enabled == "no"}style="text-decoration: line-through;color: gray;"{/if} href="./?module=ats&action=sip_modify&id={$n.s_id}">{$n.number}</a>{if $n.type=="line" && $n.line_mask != $n.number} (маска: {$n.line_mask}){/if}</td>
<td{if $n.count && $n.count > 1} rowspan={$n.count}{/if}>{if $n.atype == "link"}Привязка к {$n.type}'у{else}{$n.type}{/if}</td>
<td{if $n.count && $n.count > 1} rowspan={$n.count}{/if}>{$n.s_call_count}{if $n.type=="multitrunk"}, общий счетчик: {$n.m_call_count}{/if}{if $n.type=="line"}, {$n.lines} линий{/if}</td>
{if false}
{if $n.type == "line" && strlen($n.number) < 11 || $n.atype == "link"}
<td{if $n.count && $n.count > 1} rowspan={$n.count}{/if}></td>
{else}
<td{if $n.count && $n.count > 1} rowspan={$n.count}{/if} style="cursor: pointer; color: blue; text-decoration: underline;" onclick="doVATS('{$n.s_id}',this)">[V]</td>*}
{/if}
{/if}

<td{if $n.count && $n.count > 1} rowspan={$n.count}{/if} align=center><input name="ids[]" type=checkbox value={$n.s_id} style="padding: 0 0 0 0;margin: 0 0 0 0;"></td>
{/if}
</tr>
{/foreach}
{foreach from=$s1free item=n}
<tr style="color: #c40000; font-weight: bold;">
<td>{if access('ats', 'support')}{$n.number}{else}<a style="color: #c40000; font-weight: bold;" href="./?module=ats&action=sip_add&number={$n.id}">{$n.number}</a>{/if}</td>
<td>{$n.call_count}</td>
<td colspan=10></td>
</tr>
{/foreach}
{if !$s1free && !$s1}
<tr><td align=center colspan=9><i>Нет записей</i></td></tr>
{/if}
</table>

{else}

<table width=100% border=1 style="border-collapse:collapse;" id="sip_table">
<tr>
<td>Логин</td>
<td>Тип</td>
<td align=center><input type=checkbox style="padding: 0 0 0 0;margin: 0 0 0 0;" onclick="$('#sip_table input[type=checkbox]').each({literal}function (i,o){if(i>0){o.checked=sipAllChecked;}else{sipAllChecked = o.checked}}){/literal}"></td>
</tr>
{foreach from=$sip item=n}
<tr {if $n.enabled == "no"}style="text-decoration: line-through;color: gray;"{/if}>
<td><a {if $n.enabled == "no"}style="text-decoration: line-through;color: gray;"{/if} href="./?module=ats&action=sip_modify&id={$n.s_id}">{$n.number}</a></td>
<td>{$n.type}</td>
<td align=center><input name="ids[]" type=checkbox value={$n.s_id} style="padding: 0 0 0 0;margin: 0 0 0 0;"></td>
</tr>
{foreachelse}
<tr><td align=center colspan=9><i>Нет записей</i></td></tr>
{/foreach}
</table>
{/if}

{if !access("ats","support")}
<div style="text-align: right; padding-right: 20px;">Действие
    <select name="sip_action">
    <option value="">------------</option>
    <option value="delete">Удалить</option>
    </select>
    <input type=submit value="go" style="width: 27px; height:23px;">
    </div>
{/if}
</form>

{if $view == "number"}
<script>
{literal}

function doVATS(id, obj)
{
    $("#load_vSettings").load("./?module=ats&action=sip_users&subaction=numsettings&num_id="+id);
}
{/literal}
</script>
<div id="load_vSettings">{$load_vSettings}</div>
{else}
<div style="float:right"><a href="./?module=ats&action=sip_users">К списку номеров</a></div>
{/if}

