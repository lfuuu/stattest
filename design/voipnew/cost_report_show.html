<h1>Отчет по себестоимости:</h1>

<form action="./index.php" method="get" style="display:inline">
	<input type="hidden" name="module" value="voipnew" />
	<input type="hidden" name="action" value="cost_report" />
    <select name="f_instance_id">
        {foreach from=$regions item='r'}
        <option value="{$r->id}" {if $r->id eq $f_instance_id} selected{/if}>{$r->name}</option>
        {/foreach}
    </select>
    <select name="f_operator_id">
        <option value="0">-- Все операторы --</option>
        {foreach from=$operators item='r'}
        <option value="{$r->id}" {if $r->id eq $f_operator_id} selected{/if}>{$r->getRegionName()} {$r->short_name} ({$r->id})</option>
        {/foreach}
    </select>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    С: <input readonly type=text id="date_from" name="date_from" value="{$date_from}" />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    По: <input readonly type=text id="date_to" name="date_to" value="{$date_to}" />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <select name="f_prefix_type">
        <option value="op" {if $f_prefix_type eq 'op'} selected{/if}>Использовать операторские префиксы</option>
        <option value="mcn" {if $f_prefix_type eq 'mcn'} selected{/if}>Использовать префиксы MCN</option>
    </select>
    <br/>
	<select name="f_dest_group">
	<option value="-1" {if $f_dest_group eq '-1'} selected{/if}>-- Все направления --</option>
	<option value="1" {if $f_dest_group eq '1'} selected{/if}>Россия</option>
	<option value="2" {if $f_dest_group eq '2'} selected{/if}>Международка</option>
	<option value="3" {if $f_dest_group eq '3'} selected{/if}>СНГ</option>
	</select>
	<select name="f_country_id">
	<option value="0">-- Все страны --</option>
	{foreach from=$geo_countries item='g'}
	<option value="{$g.id}" {if $g.id eq $f_country_id} selected{/if}>{$g.name}</option>
	{/foreach}
	</select>
	<select name="f_region_id">
	<option value="0">-- Все регионы --</option>
	{foreach from=$geo_regions item='g'}
	<option value="{$g.id}" {if $g.id eq $f_region_id} selected{/if}>{$g.name}</option>
	{/foreach}
	</select>

    <select name="f_mob">
        <option value="0">-- Моб/Стац --</option>
        <option value="t" {if $f_mob eq 't'} selected{/if}>Мобильные</option>
        <option value="f" {if $f_mob eq 'f'} selected{/if}>Стационарные</option>
    </select>

  <br/>
  <input type="text" name="f_prefix" value="{$f_prefix}" placeholder="-- Префикс --"/>
<!--  <input type="text" name="f_volume" value="{$f_volume}" placeholder="-- Объем --"/> -->
  &nbsp;&nbsp;&nbsp;&nbsp;
	<input type=submit name="make" id="make_report" value="Сформировать"/>
<!--  <input type=submit name="export" value="Экспорт CSV"/> -->
</form>

<script type="text/javascript">
{literal}
    $(document).ready(function(){
        $.datepicker.regional.ru = {
            closeText: 'Закрыть',
            prevText: '&#x3c;Пред',
            nextText: 'След&#x3e;',
            currentText: 'Сегодня',
            monthNames: ['Январь','Февраль','Март','Апрель','Май','Июнь',
                'Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'],
            monthNamesShort: ['Янв','Фев','Мар','Апр','Май','Июн',
                'Июл','Авг','Сен','Окт','Ноя','Дек'],
            dayNames: ['воскресенье','понедельник','вторник','среда','четверг','пятница','суббота'],
            dayNamesShort: ['вск','пнд','втр','срд','чтв','птн','сбт'],
            dayNamesMin: ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
            weekHeader: 'Не',
            dateFormat: 'yy-mm-dd',
            firstDay: 1,
            showMonthAfterYear: false,
            yearSuffix: ''};
        $.datepicker.setDefaults($.datepicker.regional.ru);

        $('#date_from').datepicker();
        $('#date_to').datepicker();
    });
{/literal}
</script>

<table class=price cellSpacing=2 cellPadding=4 border=0>
<thead>
<tr>
    <td nowrap class=header colspan="2">&nbsp;</td>
    <td class=header colspan="2">МСN Telecom</td>
    {foreach from=$reportOperators key='k' item='op'}
    <td nowrap class=header colspan="2">{$op->short_name} ({$k})</td>
    {/foreach}
</tr>
<tr>
    <td nowrap class=header style="min-width: 100px;">Префикс номера</td>
    <td class=header style="min-width: 100px;">Назначение</td>
    <td class=header>Объем</td>
    <td class=header>Стоимость</td>
    {foreach from=$reportOperators key='k' item='op'}
    <td class=header>Объем</td>
    <td class=header>Стоимость</td>
    {/foreach}
</tr>
</thead>
<tbody>
{foreach from=$report item='rd'}
<tr class="{cycle values='even,odd'}">
	<td>{$rd.prefix}</td>
	<td>{$rd.destination}{if $rd.mob=='t'} (mob){/if}</td>
    <td align=right>{$rd.len_mcn}</td>
    <td align=right>{$rd.amount_mcn}</td>
    {foreach from=$reportOperators key='k' item='op'}
    <td align=right>{$rd.operators[$k].len_op}</td>
    <td align=right>{$rd.operators[$k].amount_op}</td>
    {/foreach}
</tr>
{/foreach}
</tbody>
<tfoot>
<tr>
    <td colspan="2"><b>Итого:</b></td>
    <td align=right><b>{$totals.len_mcn}</b></td>
    <td align=right><b>{$totals.amount_mcn}</b></td>
    {foreach from=$reportOperators key='k' item='op'}
    <td align=right><b>{$totals.operators[$k].len_op}</b></td>
    <td align=right><b>{$totals.operators[$k].amount_op}</b></td>
    {/foreach}
</tr>
</tfoot>

</table>
