<form action="" method="get">
    <input type="hidden" name="module" value="voipreports" />
    <input type="hidden" name="action" value="voip_local_report" />
    <table>
        <tr>
            <td>С</td>
            <td><select name="date_from_y" onchange="optools.friendly.dates.check_mon_right_days_count('date_from_y','date_from_m','date_from_d')">{generate_sequence_options_select start=2003 selected=$date_from_yy}</select></td>
            <td><select name="date_from_m" onchange="optools.friendly.dates.check_mon_right_days_count('date_from_y','date_from_m','date_from_d')">{generate_sequence_options_select start=1 end=12 mode='m' selected=$date_from_mm}</select></td>
            <td><select name="date_from_d" onchange="optools.friendly.dates.check_mon_right_days_count('date_from_y','date_from_m','date_from_d')">{generate_sequence_options_select start=1 end=31 mode='d' selected=$date_from_dd}</select></td>
            <td>&nbsp;</td>
            <td>По</td>
            <td><select name="date_to_y" onchange="optools.friendly.dates.check_mon_right_days_count('date_to_y','date_to_m','date_to_d')">{generate_sequence_options_select start=2003 selected=$date_to_yy}</select></td>
            <td><select name="date_to_m" onchange="optools.friendly.dates.check_mon_right_days_count('date_to_y','date_to_m','date_to_d')">{generate_sequence_options_select start=1 end=12 mode='m' selected=$date_to_mm}</select></td>
            <td><select name="date_to_d" onchange="optools.friendly.dates.check_mon_right_days_count('date_to_y','date_to_m','date_to_d')">{generate_sequence_options_select start=1 end=31 mode='d' selected=$date_to_dd}</select></td>
        </tr>
        <tr>
            <td>Оператор</td>
            <td colspan="8">
                <select name="operator">
                    <option value="all">Все</option>
                    {foreach from=$operators item='o'}
                    <option value="{$o.id}"{if $operator eq $o.id} selected='selected'{/if}>{$o.name} ({$o.id})</option>
                    {/foreach}
                </select>
            </td>
        </tr>
        <tr>
            <td>Группировка</td>
            <td colspan="8">
                <select name="groupp">
                    <option value="0">Нет</option>
                    <option value="1"{if $groupp==1} selected='selected'{/if}>По дням</option>
                    <option value="2"{if $groupp==2} selected='selected'{/if}>По месяцам</option>
                </select>
            </td>
            <td>Регион</td>
            <td colspan="8">
                <select name="region">
                    {foreach from=$regions item='r'}
                    <option value="{$r.id}"{if $r.id eq $region} selected{/if}>{$r.name}</option>
                    {/foreach}
                </select>
            </td>
        </tr>
        <tr><td colspan="9"><label><input type="checkbox" name="details" value="1" {if $details > 0}checked{/if}>подробности</label> <input type="submit" name="get" value="Сформировать" /></td></tr>
    </table>
</form>

{if isset($report)}
<table class='price' cellSpacing='4' cellPadding='2'  border='0'>
    <tr>
        {if $groupp}<td class='header'>Дата</td>{/if}
        <td class='header'>Оператор</td>
        {foreach from=$columns item='n'}
        <td class='header'>{$n}</td>
        {/foreach}
    </tr>
    {foreach from=$report item='r'}
    <tr class="{cycle values='even,odd'}">
        {if $groupp}<td>{$r.date}</td>{/if}
        <td>{$operators[$r.operator_id].name} ({$operators[$r.operator_id].id})</td>
        {foreach from=$columns key='k' item='n'}
        <td>{if $r[$k]}
                {if $details}
                    Длительность (мин):<br />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;факт <b>{$r[$k].len|round:2}</b><br />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;оператор {$r[$k].len_op|round:2}<br />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MCN {$r[$k].len_mcn|round:2}<br />
                    Стоимость:<br />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;оператор    {$r[$k].amount_op|round:2}<br />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MCN {$r[$k].amount_mcn|round:2}<br />
                    Количество: <b>{$r[$k].count}</b><br />
                {else}
                    Минут: <b>{$r[$k].len|round:2}</b><br />
                    Количество: <b>{$r[$k].count}</b><br />
                {/if}
            {/if}
        </td>
        {/foreach}
    </tr>
    {/foreach}
</table>

{/if}