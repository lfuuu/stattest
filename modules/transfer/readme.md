Модуль переноса
===============

Неуниверсальные услуги в рамках модуля называются _Regular_.
Универсальные услуги - _Universal_

Структура модуля
----------------
* components
Каталог подразумевает, что модуль может уметь переносить не только услуги, но и другие сущности (например: Контрагентов)
На текущий момент содержит функционал только для переноса услуг
    * services
    Каталог содержит полный код переноса услуг
        * regular
        Классы-обработчики переноса неуниверсальных услуг
            * _RegularTransfer_
            Базовый класс переноса неуниверсальных услуг, унаследован от _Processor_
        * universal
        Классы-обработчики переноса универсальных услуг
            * _UniversalTransfer_
            Базовый класс переноса универсальных услуг, унаследован от _Processor_
        * _Processor_
        Класс, описывающий порядок выполнения переноса
        * _PreProcessor_
        Класс, описывающий структуру данных необходимых для переноса (фактически "Строитель")
        * _ServiceTransfer_
        Абстрактный класс, которому должны следовать остальные обработчики переноса

* controllers
Контроллеры модуля

* forms
Формы модуля

* views
Представления модуля

Порядок работы переноса услуг
-----------------------------
1. Создание объекта _PreProcessor_
    1.1. _setProcessor_
    Устанавливает обработчик переноса (RegularTransfer|UniversalTransfer), необходим для понимания, кем обрабатывается
    перенос услуг
    1.2. _setServiceType_
    Указывает, какой тип услуги переносится, доступные услуги перечисленны в _Processor_ в виде констант
    1.3. _setService_
    Устанавливает обработчик переносимой услуги, базируясь на п.1.1.
    1.4. _setProcessedFromDate_
    Устанавливает дату переноса
    1.5. _setSourceClientAccount_
    Устанавливает лицевой счет с которого происходит перенос
    1.6. _setTargetClientAccount_
    Устанавливает целевой лицевой счет
    1.7. _setTariff_
    Устанавливает тарифный план, используется при кросс-переносе (Regular -> Universal)
    1.8. _setRelation_
    Устанавливает поле-связь для сложноструктурированных услуг
```
    (new PreProcessor)
        ->setProcessor(new RegularTransfer)
        ->setServiceType(Processor::SERVICE_VOIP)
        ->setService(
            (new RegularTransfer)->getHandler(Processor::SERVICE_VOIP),
            $serviceId
        )
        ->setProcessedFromDate('2017-08-01')
        ->setSourceClientAccount(14410)
        ->setTargetClientAccount(41449)
        ->setTariff(5766)
```
2. Процесс переноса
    2.1. Проверяется валидность настроенного _PreProcessor_ объекта
    2.2. Закрывается исходная услуга (_closeService_)
    2.3. Создается целевая услуга (_openService_)
    2.4. Сохраняюся п.2.2. и п.2.3.
    2.5. Выполняется инструкция обработчика переноса (_finalizeClose_) для реализации закрытия исходной услуги
        2.5.1. Установка связующих данных в исходной услуге
    2.6. Выполняется инструкция обработчика переноса (_finalizeOpen_) для реализации создания целевой услуги
        2.6.1. Установка связущих данных в целевой услуге
        2.6.2. Выполнение инструкций по созданию сложноструктурированных услуг
    2.7. Регистрируется значимое событие переноса исходной услуги