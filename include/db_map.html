<html><head><title>db_map</title></head><body>
<h1>Основные действия</h1>
<h2>Добавление таблицы</h2><ol>
<li>Прописать ключевые поля в $keys
<li>Прописать связи в $links
<li>Прописать контроль типов в $types
<li>Если будут таблицы, в которых содержимое данной будет отображаться в виде списка, заполнить $visible_in_list
<li>Если есть поля с фиксированным набором значений, указать их в variants
<li>Если необходимо скрыть поля (для всех), прописать их в $hidden
<li>Установить порядок вывода полей в $order
</ol>

<h2>Добавление поля</h2>
Для добавления поля достаточно добавить это поле к базе. Остальное - опционально.<br>

<h2>Проверка значений</h2>
Выполняется в таблице $types. Возможна двойная проверка: вначале просто типа данных, потом с помощью кода php. Имеет вид:<br>
<i>				'usage_ip_ports.tarif_old_id'		=> array('no',			'if (!$value) $ignore["tarif_old_id"]=true;'),</i><br>
Доступны переменные: $value - значение данной ячейки, $row - весь столбец, $old - старые значения в столбце, $ignore - массив полей, которые будут игнорироваться при проверке связей<br>

<h1>Действия со связанными таблицами</h1>
<h2>Обновление полей в других таблицах</h2>
Обновление удобнее всего делать через $postactions. Внутри кода $postactions доступна переменная $row - обновляемая/добавляемая запись в основную таблицу (то есть, ту, запрос на изменение которой был подан изначально).<br>

<h2>Копирование значений из других таблиц</h2>
В таблице $links третье поле - код, который выполняется при просмотре связанной таблицы. Доступны переменные $row - запись в основной таблице, $r - запись в связанной таблице. Для установки $row['fieldN'] рекомендуется пользоваться функцией $this->rset('fieldN',$value).<br>

<h2>Показ записей из других таблиц в раскрывающемся списке c фильтрацией</h2>
Например, используется для вывода устройств, e-mail адресов и доменов клиента. Для фильтрации нужно четвёртым параметром $links передать код php, который установит значение переменной $wh_add - в виде WHERE-условия SQL-запроса.

<h1>Доступ</h1>
<h2>Скрытие поля для отдельных групп пользователей</h2>
Поле прописывается в переменную $readonly. После этого вызов функции ShowEditForm выполняется так:<br>
<i>	$dbmap->ShowEditForm('some_table','some_table.id='.$id,array(),1,<b>!access("some_module","full_access")</b>);</i>

</body>