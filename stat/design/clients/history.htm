  <script src="js/jquery.js"></script>
  <script src="js/ui/jquery-ui.custom.js"></script>
  <script src="js/ui/i18n/jquery.ui.datepicker-ru.{if $isViewOnly}utf8.{/if}js"></script>
  <link rel="stylesheet" href="css/themes/base/jquery-ui.css">


<form action="./?module=clients&client_id={$log[0].client_id}&action=view_history" method=post>
<font style="font: normal 8pt sans-serif;"><h4>История изменений клиента</h4>
<table border=0 style="font: normal 8pt sans-serif;">
{foreach from=$log item=l}
<tr >
<td style="border-top: 1px solid #aaa;{if $l.is_overwrited=='yes'}color: gray;text-decoration: line-through;{/if}" align=right><b>
{if $isAdmin}<a href="./?module=clients&client_id={$l.client_id}&action=view_history&del_section={$l.id}">x</a><input type="radio" name="fs" value="{$l.id}">{/if}
{$l.ts}</b>
{if $l.apply_ts}<br>{if $l.is_apply_set == 'no'}<b style="color: #c40000;">применить{else}<b style="color: #555;">применено{/if} c {$l.apply_ts}</b>{if $isAdmin} <a href="./?module=clients&client_id={$l.client_id}&action=view_history&del_apply={$l.id}"><img width=6 height=6 src="./images/del2.gif" valign=absmiddle border=0></a>{/if}{/if}
{if $isAdmin} <img class="date_selector" data-id="{$l.id}" data-year="{$l.apply.0}" data-month="{$l.apply.1}" data-day="{$l.apply.2}" width=12 height=13 src="./images/date_selector.gif" valign=absmiddle border=0></a>{/if}
</td>
<td style="border-top: 1px solid #aaa;"><b>{$l.name}:</b></td>
<td style="border-top: 1px solid #aaa;">&nbsp;</td>
<td style="border-top: 1px solid #aaa;">&nbsp;</td>
<td style="border-top: 1px solid #aaa;">&nbsp;</td>
</tr>
{foreach from=$l.fields item=f}
<tr>
{if $isAdmin}<td><a href="./?module=clients&client_id={$l.client_id}&action=view_history&del_value={$f.id}">x</a></td>{/if}
<td style="border-top: 1px solid #ddd;">{if $isAdmin}<input type="checkbox" name="ff[]" value="{$f.id}">{/if}{$f.name}:</td>
<td style="border-top: 1px solid #ddd;" ><i>{$f.value_from}</i></td>
{if $f.value_to || $isAdmin}
<td style="border-top: 1px solid #ddd;"> =&gt; </td>
<td style="border-top: 1px solid #ddd;"><i>{if $isAdmin && $f.value_to != $c[$f.field]}<a href="./?module=clients&client_id={$l.client_id}&action=view_history&apply_value={$f.id}">{$f.value_to}&nbsp;</a>{else}{$f.value_to}{/if}</i></td>
{/if}
</tr>
{/foreach}
{/foreach}

</table>
</font>
{if $isAdmin}
<input type=submit>

<div style="display: none;" id="dialog-confirm" title="Установите дату применения: ">
  <p><div id="datepicker"></div></p>
  </div>

<script>
{literal}
$(function() {

        $( "#datepicker" ).datepicker($.datepicker.regional[ "ru" ]).datepicker({maxDate: "-1d"});
        $( "#datepicker" ).datepicker("option", "maxDate", "-1d");

$("img.date_selector").click(function(){
        console.log(this);
        var tData = $(this).data();
        $( "#dialog-confirm" ).dialog({
            resizable: false,
            height:430,
            width: 400,
            modal: true,
            buttons: {
            "Сохранить": function() {
                var date1 = $( "#datepicker" ).datepicker("getDate");

                location.href = "./?module=clients&client_id={/literal}{$l.client_id}{literal}&action=view_history&add_apply="+tData.id+"&date="+date1.getFullYear()+"-"+(date1.getMonth()+1)+"-"+date1.getDate();
                //$( this ).dialog( "close" );
                },

            "Отмена": function() {
                $( this ).dialog( "close" );
                }
            }
        });

        if(tData.year == "")
        {
            var date1 = new Date();
        }else{
            var date1 = new Date(tData.year, tData.month-1, tData.day);
        }
        console.log(date1);
        $( "#datepicker" ).datepicker("setDate", date1);
    });
});
{/literal}
</script>
{/if}
</form>
