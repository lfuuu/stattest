<script src="js/jquery.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/ui/i18n/jquery.ui.datepicker-ru.js"></script>
<link href="css/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css"/>

<h2>Отчет. {$client_name} {$date}</h2>
{if false}
<div style="text-align: right; padding-right: 100px;">
<a href="./?{if $viewLink}module=stats&action={$report}{/if}&do=add">Создать заявку</a>
</div>
{/if}
<style>
{literal}
#repart_table td {
    padding: 2px 2px 2px 2px;
    font: normal 8pt sans-serif;
}
#tr_head td {
    font-weight: bold;
    text-align: center;
}
.ui-datepicker {
	font-size: 10px;
}
{/literal}
</style>
{if $showSelects}
<form action="" method=get>
	<input type="hidden" name="module" value="stats" />
	<input type="hidden" name="action" value="{$report}" />
    <table>
    	<tr>
    		<td>C </td>
    		<td><input class="datepicker-input" type=text value="{$date_from}" id=date_from name=date_from></td>
    		<td>по </td>
    		<td><input class="datepicker-input" type=text value="{$date_to}"  id=date_to name=date_to></td>
    		<td><input type=submit value="OK"></td>
                <td style="width: 100px;">&nbsp;</td>
                <td>
                    <input type="text" value="" id="order_id">
                    <input type=button value="Проверить заказ" onclick="show_order_info();return false;">
                </td>
    	</tr>
        <tr>
            <td colspan=5>Показать: {html_options options=$filter_promo_all selected=$filter_promo name="filter_promo"}</td>
        </tr>
    </table>
<script>
optools.DatePickerInit();
</script>
    </form>
{/if}
<table border=1 style="border-collapse:collapse; width: 300px;text-align:center;">
<tr><td><b>В Обработке</b></td><td>{if $s.work}{$s.work}{else}0{/if}</td><td><a href="./?{$url}&list=work">Посмотреть&raquo;</a></td></tr>
<tr><td><b>Достaвлен</b></td><td>{if $s.close}{$s.close}{else}0{/if}</td><td><a href="./?{$url}&list=close">Посмотреть&raquo;</a></td></tr>
<tr><td><b>Отказ</b></td><td>{if $s.reject}{$s.reject}{else}0{/if}</td><td><a href="./?{$url}&list=reject">Посмотреть&raquo;</a></td></tr>
<tr><td><b>Возврат</b></td><td>{if $s.rollback}{$s.rollback}{else}0{/if}</td><td><a href="./?{$url}&list=rollback">Посмотреть&raquo;</a></td></tr>
</table><br>
{if $list}
<h2>{$listName}</h2>
<div style="text-align: right;"><a href="./?{$url}&list={$listType}&export=excel">Экспорт в Excel</a></div>
<table id=repart_table border=1 style="border-collapse: collapse;" cellspacing=2 >
<tr id="tr_head">
<td rowspan=2 width=1%>#</td>
<td rowspan=2 width=10%>Оператор</td>
<td colspan=2 width=10%>Номер счета</td>
<td rowspan=2 width=10%>Дата<br>создания заказа</td>
<td colspan=6 width=1%>Кол-во</td>
<td colspan=1 width=10%>Номер купона</td>
<td rowspan=2 width=30%>Клиент <br />(ФИО, телефон, адрес)</td>
<td colspan=2 width=10%>Дата доставки</td>
<td rowspan=2 width=20%>Этапы</td>
</tr>
<tr id="tr_head">
<td>OnLime</td>
<td>Маркомнет Сервис</td>
<td>Tele CARD</td>
<td>HD-ресивер</td>
<td>НВ-р. с диском</td>
<td>NetGear роутер</td>
<td>Zyxel KEENETIC EXTRA</td>
<td>D-Link DWA-182</td>
<td>Gigaset C530</td>
<td>Серийный номер</td>
<td>Желаемая</td>
<td>Фактическая</td>
</tr>

{foreach from=$list item=i key=idx}
<tr>
<td rowspan=2>{$idx+1}.</td>
<td rowspan=2>{$i.fio_oper}</td>
<td rowspan=2>{$i.req_no}</td>
<td rowspan=2>{if $viewLink}<a href="./?module=newaccounts&action=bill_view&bill={$i.bill_no}">{/if}{$i.bill_no}{if $viewLink}</a>{/if}{if $i.fio_oper != 'onlime_shop'}&nbsp;<a href="./?{if $viewLink}module=stats&action={$report}{/if}&do=edit&bill_no={$i.bill_no}"><img src="./images/icons/edit.gif" border=0 align=absmiddle></a>{/if}</td>
<td rowspan=2>{$i.date_creation}</td>
<td rowspan=2 align=center>{$i.count_3|round:0}</td>
<td rowspan=2 align=center>{$i.count_9|round:0}</td>
<td rowspan=2 align=center>{$i.count_11|round:0}</td>
<td rowspan=2 align=center>{$i.count_12|round:0}</td>
<td rowspan=2 align=center>{$i.count_18|round:0}</td>
<td rowspan=2 align=center>{$i.count_19|round:0}</td>
<td rowspan=2 align=center>{$i.count_22|round:0}</td>
<td colspan=1>{if $i.coupon}{$i.coupon}{/if}</td>
<td rowspan=2><p>{$i.fio}</p>
    <p>{$i.phone}</p>
    <p>{$i.address}</p></td>
<td rowspan=2>{$i.date_deliv}</td>
<td rowspan=2>{$i.date_delivered|substr:0:-3}</td>
<td rowspan=2>
<div id="d_{$idx}" style="display:none;" title="Заказ {$i.bill_no}">
{include file='stats/onlime_stage.tpl' i_stages=$i.stages last=100}
</div>
{include file='stats/onlime_stage.tpl' i_stages=$i.stages last=2}
{if count($i.stages) > 2}
    <div style="cursor: pointer; color: blue;" class="to_view" id="t_{$idx}">Посмотреть всю историю</div>
{/if}
</td>
</tr>
<tr>
    <td>{$i.serials|replace:",":",<br>"}</td>
</tr>
{/foreach}
{if $list}
<tr>
    <td colspan=5 align=right><b>Итого:</b>&nbsp;&nbsp;</td>
    <td align=center><b>{$total.count_3}</b></td>
    <td align=center><b>{$total.count_9}</b></td>
    <td align=center><b>{$total.count_11}</b></td>
    <td align=center><b>{$total.count_12}</b></td>
    <td align=center><b>{$total.count_18}</b></td>
    <td align=center><b>{$total.count_19}</b></td>
    <td align=center><b>{$total.count_22}</b></td>
    <td colspan=5>&nbsp;</td>
</tr>
{/if}
</table>
<script>
{literal}

$("div.to_view").click(function(e){
    $("#"+e.srcElement.id.replace("t_", "d_")).dialog();
})

{/literal}
</script>
{/if}
<div id="order_details" title="Подробная информация" style="display: none;"></div>
<script>
{literal}
    function show_order_info()
    {
        $('a.ui-dialog-titlebar-close').click();
        $("#order_details").html('');
        $("#order_details").dialog(
        {
            width: 850,
            height: 400,
            open: function(){
                $(this).load('./index_lite.php?module=stats&action=onlime_details&order_id=' + $('#order_id').val());
            }
        });
    }
{/literal}
</script>
