
<script type="text/javascript">
{literal}

$(document).ready(function() {
	$('.i_s_i').live('change', function(e){
		if($(this).val() == 'on') {
			$('#d_s_i').show();
		} else {
			$('#d_s_i select').val('0');
			$('#d_s_i').hide();
		}
	});
	$('.i_s_e').live('change', function(e){
		if($(this).val() == 'on') {
			$('#d_s_e').show();
		} else {
			$('#d_s_e select').val('0');
			$('#d_s_e').hide();
		}
	});
});
{/literal}
</script>

<form action="" method="get">
<input type="hidden" name="module" value="stats" />
<input type="hidden" name="action" value="report_services" />
<input type="hidden" name="fix" value="yes" />
<table border="1" align="center">
	<tr>
		<td>Услуга</td>
		<td>Фильтр</td>
		<td>Статус</td>
	</tr>
	<tr>
		<td>Интернет</td>
		<td>
			<table>
				<tr><td>Присутствует</td><td>-</td><td><input class="i_s_i" type="radio" name="s_i" value="on"{if isset($s_i) && $s_i} checked{/if} /></td></tr>
				<tr><td>Отсутствует</td><td>-</td><td><input class="i_s_i" type="radio" name="s_i" value="off"{if isset($s_i) && !$s_i} checked{/if} /></td></tr>
				<tr><td>Не задано</td><td>-</td><td><input class="i_s_i" type="radio" name="s_i" value="unset"{if !isset($s_i)} checked{/if} /></td></tr>
				<tr><td colspan="3"><div id="d_s_i" style="display: {if isset($s_i) && $s_i}block;{else}none;{/if}">Тариф:<br><select name="s_s_i" style="width: 120px;"><option value="0">Любой</option>{foreach from=$i_tarifs item='t'}<option value="{$t.id}" {if $s_s_i == $t.id}selected{/if}>{$t.name}</option>{/foreach}</select></div></td></tr>
			</table>
		</td>
		<td rowspan="5">
		  <input type="checkbox" name="status[]" value="negotiations" {if in_array('negotiations', $statuses)}checked{/if} /> В стадии переговоров<br />
		  <input type="checkbox" name="status[]" value="testing" {if in_array('testing', $statuses)}checked{/if} /> Тестируемые<br />
		  <input type="checkbox" name="status[]" value="connecting" {if in_array('connecting', $statuses)}checked{/if} /> Подключаемые<br />
		  <input type="checkbox" name="status[]" value="work" {if in_array('work', $statuses)}checked{/if} /> Включенные<br />
		  <input type="checkbox" name="status[]" value="closed" {if in_array('closed', $statuses)}checked{/if} /> Отключенные<br />
		  <input type="checkbox" name="status[]" value="tech_deny" {if in_array('tech_deny', $statuses)}checked{/if} /> С тех. отказом<br />
		  <input type="checkbox" name="status[]" value="telemarketing" {if in_array('telemarketing', $statuses)}checked{/if} /> telemarketing<br />
		  <input type="checkbox" name="status[]" value="income" {if in_array('income', $statuses)}checked{/if} /> income<br />
		  <input type="checkbox" name="status[]" value="deny" {if in_array('deny', $statuses)}checked{/if} /> Отказ<br />
		  <input type="checkbox" name="status[]" value="debt" {if in_array('debt', $statuses)}checked{/if} /> Отключенные за долги<br />
		  <input type="checkbox" name="status[]" value="double" {if in_array('double', $statuses)}checked{/if} /> Дубликаты<br />
		  <input type="checkbox" name="status[]" value="trash" {if in_array('trash', $statuses)}checked{/if} /> Мусор<br />
		  <input type="checkbox" name="status[]" value="move" {if in_array('move', $statuses)}checked{/if} /> move<br />
		  <input type="checkbox" name="status[]" value="already" {if in_array('already', $statuses)}checked{/if} /> already<br />
		  <input type="checkbox" name="status[]" value="denial" {if in_array('denial', $statuses)}checked{/if} /> Отказ/задаток<br />
		  <input type="checkbox" name="status[]" value="once" {if in_array('once', $statuses)}checked{/if} /> Интернет Магазин<br />
		  <input type="checkbox" name="status[]" value="reserved" {if in_array('reserved', $statuses)}checked{/if} /> reserved<br />
		  <input type="checkbox" name="status[]" value="suspended" {if in_array('suspended', $statuses)}checked{/if} /> Приостановленные<br />
		  <input type="checkbox" name="status[]" value="operator" {if in_array('operator', $statuses)}checked{/if} /> Операторы<br />
		  <input type="checkbox" name="status[]" value="distr" {if in_array('distr', $statuses)}checked{/if} /> Поставщики<br />
		  <input type="checkbox" name="status[]" value="blocked" {if in_array('blocked', $statuses)}checked{/if} /> Временно заблокирован<br />
		</td>
	</tr>
	<tr>
		<td>Телефония</td>
		<td>
			<table>
				<tr><td>Присутствует</td><td>-</td><td><input type="radio" name="s_p" value="on"{if isset($s_p) && $s_p} checked{/if} /></td></tr>
				<tr><td>Отсутствует</td><td>-</td><td><input type="radio" name="s_p" value="off"{if isset($s_p) && !$s_p} checked{/if} /></td></tr>
				<tr><td>Не задано</td><td>-</td><td><input type="radio" name="s_p" value="unset"{if !isset($s_p)} checked{/if} /></td></tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>VPN</td>
		<td>
			<table>
				<tr><td>Присутствует</td><td>-</td><td><input type="radio" name="s_v" value="on"{if isset($s_v) && $s_v} checked{/if} /></td></tr>
				<tr><td>Отсутствует</td><td>-</td><td><input type="radio" name="s_v" value="off"{if isset($s_v) && !$s_v} checked{/if} /></td></tr>
				<tr><td>Не задано</td><td>-</td><td><input type="radio" name="s_v" value="unset"{if !isset($s_v)} checked{/if} /></td></tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>Collocation</td>
		<td>
			<table>
				<tr><td>Присутствует</td><td>-</td><td><input type="radio" name="s_c" value="on"{if isset($s_c) && $s_c} checked{/if} /></td></tr>
				<tr><td>Отсутствует</td><td>-</td><td><input type="radio" name="s_c" value="off"{if isset($s_c) && !$s_c} checked{/if} /></td></tr>
				<tr><td>Не задано</td><td>-</td><td><input type="radio" name="s_c" value="unset"{if !isset($s_c)} checked{/if} /></td></tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>Дополнительные услуги</td>
		<td>
			<table>
				<tr><td>Присутствуют</td><td>-</td><td><input class="i_s_e" type="radio" name="s_e" value="on"{if isset($s_e) && $s_e} checked{/if} /></td></tr>
				<tr><td>Отсутствует</td><td>-</td><td><input class="i_s_e" type="radio" name="s_e" value="off"{if isset($s_e) && !$s_e} checked{/if} /></td></tr>
				<tr><td>Не задано</td><td>-</td><td><input class="i_s_e" type="radio" name="s_e" value="unset"{if !isset($s_e)} checked{/if} /></td></tr>
				<tr><td colspan="3">
				    <div id="d_s_e" style="display: {if isset($s_e) && $s_e}block;{else}none;{/if}">Тариф:<br>
				        <select name="s_s_e" style="width: 120px;">
				            <option value="0">Любой</option>
				            {foreach from=$e_tarifs item='t'}<option value="{$t.id}" {if $s_s_e == $t.id}selected{/if}>{if strlen($t.code)}({$t.code}) {/if}{$t.description} &nbsp;&nbsp;&nbsp;({$t.price} {$t.currency})</option>{/foreach}
				        </select>
				    </div>
				</td></tr>
			</table>
		</td>
	</tr>
	<tr align="center"><td colspan="3"><input type="submit" value="Ok" /></td></tr>
</table>
</form>
{if $fix}
{assign var='total_title' value='#bcbcbc'}
{assign var='section_title' value='#bcbcbc'}
{assign var='cycvals' value='#dfdfdf,white'}
<table align="center" cellpadding="0" cellspacing="2">
	<tr align="center" style="background-color:{$total_title}"><td colspan="3">Всего клиентов: {$scount}</td></tr>
	<tr align="center" style="background-color:{$total_title}">
		<td colspan="2">Тариф</td>
		<td>Клиент</td>
	</tr>
	{if $icount}
	<tr align="center" style="background-color:{$section_title}">
		<td colspan="2">Интернет</td>
		<td>Общее число: {$icount}</td>
	</tr>
	{assign var='cnt' value='0'}
	{foreach from=$tarifs_map.I item='t' key='k'}
	{assign var='cnt' value=$cnt+1}
	<tr style="background-color:{cycle values=$cycvals}">
		<td>{$cnt}</td>
		<td><a href="index.php?module=tarifs&action=edit&m=internet&id={$tarifs.I[$k].id}" target="_blank">{$t}</a></td>
		<td><a href="/client/clientview?id={$tarifs.I[$k].client.id}" target="_blank">{$tarifs.I[$k].client.client}</a></td></tr>
	{/foreach}
	{/if}
	{if $pcount}
	<tr align="center" style="background-color:{$section_title}">
		<td colspan="2">Телефония</td>
		<td>Общее число: {$pcount}</td>
	</tr>
	{assign var='cnt' value='0'}
	{foreach from=$tarifs_map.P item='t' key='k'}
	{assign var='cnt' value=$cnt+1}
	<tr style="background-color:{cycle values=$cycvals}">
		<td>{$cnt}</td>
		<td><a href="index.php?module=tarifs&action=edit&m=voip&id={$tarifs.P[$k].id}" target="_blank">{$t}</a></td>
		<td><a href="/client/clientview?id={$tarifs.P[$k].client.id}" target="_blank">{$tarifs.P[$k].client.client}</a></td></tr>
	{/foreach}
	{/if}
	{if $vcount}
	<tr align="center" style="background-color:{$section_title}">
		<td colspan="2">VPN</td>
		<td>Общее число: {$vcount}</td>
	</tr>
	{assign var='cnt' value='0'}
	{foreach from=$tarifs_map.V item='t' key='k'}
	{assign var='cnt' value=$cnt+1}
	<tr style="background-color:{cycle values=$cycvals}">
		<td>{$cnt}</td>
		<td><a href="index.php?module=tarifs&action=edit&m=vpn&id={$tarifs.V[$k].id}" target="_blank">{$t}</a></td>
		<td><a href="/client/clientview?id={$tarifs.V[$k].client.id}" target="_blank">{$tarifs.V[$k].client.client}</a></td></tr>
	{/foreach}
	{/if}
	{if $ccount>0}
	<tr align="center" style="background-color:{$section_title}">
		<td colspan="2">Collocation</td>
		<td>Общее число: {$ccount}</td>
	</tr>
	{assign var='cnt' value='0'}
	{foreach from=$tarifs_map.C item='t' key='k'}
	{assign var='cnt' value=$cnt+1}
	<tr style="background-color:{cycle values=$cycvals}">
		<td>{$cnt}</td>
		<td><a href="index.php?module=tarifs&action=edit&m=collocation&id={$tarifs.C[$k].id}" target="_blank">{$t}</a></td>
		<td><a href="/client/clientview?id={$tarifs.C[$k].client.id}" target="_blank">{$tarifs.C[$k].client.client}</a></td></tr>
	{/foreach}
	{/if}
	{if $ecount}
	<tr align="center" style="background-color:{$section_title}">
		<td colspan="2">Дополнительные услуги</td>
		<td>Общее число: {$ecount}</td>
	</tr>
	{assign var='cnt' value='0'}
	{foreach from=$tarifs_map.E item='t' key='k'}
	{assign var='cnt' value=$cnt+1}
	<tr style="background-color:{cycle values=$cycvals}">
		<td>{$cnt}</td>
		<td><a href="index.php?module=tarifs&action=edit&m=extra&id={$tarifs.E[$k].id}" target="_blank">{$t}</a></td>
		<td><a href="/client/clientview?id={$tarifs.E[$k].client.id}" target="_blank">{$tarifs.E[$k].client.client}</a></td></tr>
	{/foreach}
	{/if}
	{if $scount}
	<tr align="center" style="background-color:{$section_title}">
		<td colspan="2">Все</td>
		<td>Общее число: {$scount}</td>
	</tr>
	{assign var='cnt' value='0'}
	{foreach from=$show item='t' key='k'}
	{assign var='cnt' value=$cnt+1}
	<tr style="background-color:{cycle values=$cycvals}">
		<td>{$cnt}</td>
		<td colspan="2"><a href="/client/clientview?id={$t.id}" target="_blank">{$t.client}</a></td></tr>
	{/foreach}
	{/if}
</table>
{/if}
