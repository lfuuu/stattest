<h1>Отчет по звонкам:</h1>

<form action="./index.php" method="get" style="display:inline">
	<input type="hidden" name="module" value="voipreports" class="hptodel" />
	<input type="hidden" name="action" value="calls_report" class="hptodel" />
    <select class="select2" name="f_server_id" style="width: 180px">
        <option value="0" {if $f_server_id eq 0} selected{/if}>-- Точка присоединения --</option>
        {foreach from=$regions item='r'}
        <option value="{$r->id}" {if $r->id eq $f_server_id} selected{/if}>{$r->name} ({$r->id})</option>
        {/foreach}
    </select>
    <select class="select2" style="width: 300px" name="f_trunk_id">
        <option value="0">-- Транк --</option>
        {foreach from=$trunks item='o'}
        <option value="{$o.id}"{if $trunk eq $o.id} selected='selected'{/if}>{$o.name} ({$o.id})</option>
        {/foreach}
    </select>
    <select class="select2" style="width: 300px" name="f_service_trunk_id">
        <option value="0">-- Услуга транк --</option>
        {foreach from=$serviceTrunks item='o'}
        <option value="{$o.id}"{if $serviceTrunk eq $o.id} selected='selected'{/if}>{$o.name} ({$o.id})</option>
        {/foreach}
    </select>

    <div style="height: 5px"></div>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    С: <input readonly type=text id="date_from" class="datepicker" name="date_from" value="{$date_from}" />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    По: <input readonly type=text id="date_to" class="datepicker" name="date_to" value="{$date_to}" />

    (время в UTC)
    <div style="height: 5px"></div>

	<select class="select2" name="f_country_id" style="width: 250px">
	<option value="0">-- Все страны --</option>
	{foreach from=$geo_countries item='g'}
	<option value="{$g.id}" {if $g.id eq $f_country_id} selected{/if}>{$g.name}</option>
	{/foreach}
	</select>
	<select class="select2" name="f_region_id" style="width: 300px">
	<option value="0">-- Все регионы --</option>
	{foreach from=$geo_regions item='g'}
	<option value="{$g.id}" {if $g.id eq $f_region_id} selected{/if}>{$g.name}</option>
	{/foreach}
	</select>

    <select name="f_mob">
        <option value="0">-- Моб/Стац --</option>
        <option value="t" {if $f_mob eq 't'} selected{/if}>Мобильные</option>
        <option value="f" {if $f_mob eq 'f'} selected{/if}>Стационарные</option>
    </select>

    <select name="f_direction_out">
        <option value="t" {if $f_direction_out eq 't'} selected{/if}>Оригинация</option>
        <option value="f" {if $f_direction_out eq 'f'} selected{/if}>Терминация</option>
    </select>

    <div style="height: 5px"></div>

    <div style="height: 5px"></div>

    &nbsp;&nbsp;&nbsp;&nbsp;
    <input name="offset" type="hidden" value="0" id="calls_report_offset"/>

    <input type=submit name="make" id="make_report" value="Сформировать"/>

    <input type=submit name="makeFile" value="Сгенерировать и загрузить файл"/>

    {if $item_from > 0}
        <div style="height: 5px"></div>
        звонки {$item_from} - {$item_to}
        &nbsp;&nbsp;&nbsp;&nbsp;
        {if $previous_offset !== 'none'}
        <input type=submit onclick="document.getElementById('calls_report_offset').value='{$previous_offset}';" name="make" value="Предыдущие"/>
        {/if}
        {if $next_offset !== 'none'}
        <input type=submit onclick="document.getElementById('calls_report_offset').value='{$next_offset}';" name="make" value="Следующие 100"/>
        {/if}
    {/if}


</form>
<br/><br/>
<table class=price cellSpacing=2 cellPadding=4 border=0>
<thead>
<tr>
    <td class=header>Id</td>
    <td class=header style="min-width: 100px;">Дата (UTC)</td>
    <td class=header>Исходящий номер</td>
    <td class=header>Входящий номер</td>
    <td class=header>Длительность</td>
    <td class=header>Стоимость</td>
    <td class=header>Направление</td>
    <td class=header>Точка присоединения</td>
    <td class=header>Транк</td>
    <td class=header>Услуга транк</td>
</tr>
</thead>
<tbody>
{foreach from=$report item='rd'}
<tr class="{cycle values='even,odd'}">
    <td style="color: #AAA">{$rd.id}</td>
	<td>{$rd.connect_time}</td>
    <td>{$rd.src_number}</td>
    <td>{$rd.dst_number}</td>
    <td>{$rd.billed_time}</td>
    <td>{$rd.cost}</td>
    <td>{$rd.destination}{if $rd.mob=='t'} (mob){/if}</td>
    <td>{$regions[$rd.server_id]->name} ({$rd.server_id})</td>
    <td>{$trunks[$rd.trunk_id].name} ({$rd.trunk_id})</td>
    <td>{$serviceTrunks[$rd.trunk_service_id].name} ({$rd.trunk_service_id})</td>

</tr>
{/foreach}
</tbody>

</table>