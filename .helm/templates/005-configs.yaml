{{ $_ := set . "params" .Values.params_dev }}

{{- if (eq (env "ENVNAME") "prod") }}
  {{ $_ := set . "params" (ternary .Values.params_prod_eu .Values.params_prod (eq (env "COUNTRY") "EU")) }}
{{- end }}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-config-files
data:
{{- if (eq (env "ENVNAME") "dev") }}
  .pgpass: |
{{ .Files.Get ".werf/tmp/.pgpass" | indent 8 }}
{{- end }}
  php.ini: |
    [PHP]
    SMTP = mail.mcn.ru
    sendmail_path = /usr/sbin/sendmail -S mail.mcn.ru -t -i -f root@tiberis.mcn.ru

    output_buffering = 4096
    expose_php = Off
    max_execution_time = 36000
    max_input_time = 36000
    max_input_vars = 100000
    memory_limit = 4G
    post_max_size = 90M
    upload_max_filesize = 500M
    serialize_precision = 100
    short_open_tag = On

    error_reporting = {{ .Values.php_prod.error_reporting }}
    display_errors = {{ .Values.php_prod.display_errors }}
    display_startup_errors = {{ .Values.php_prod.display_startup_errors }}

    enable_dl = {{ .Values.php_prod.enable_dl }}

    log_errors = {{ .Values.php_prod.log_errors }}
    error_log = {{ .Values.php_prod.error_log }}

    report_memleaks = {{ .Values.php_prod.report_memleaks }}

    variables_order = {{ .Values.php_prod.variables_order | quote }}
    request_order = {{ .Values.php_prod.request_order | quote }}
    date.timezone = {{ .Values.php_prod.date.timezone | quote }}

    [Session]
    session.save_path = {{ .Values.php_prod.session.save_path }}
    session.gc_maxlifetime = {{ .Values.php_prod.session.gc_maxlifetime }}
    session.gc_probability = {{ .Values.php_prod.session.gc_probability }}

  php-fpm.www.conf: |
    [www]
    listen = {{ .Values.php_fpm_prod.listen.to }}
    ;listen.allowed_clients = {{ .Values.php_fpm_prod.listen.allowed_clients }}
    listen.owner = {{ .Values.php_fpm_prod.listen.owner }}
    listen.group = {{ .Values.php_fpm_prod.listen.group }}
    ;listen.mode = {{ .Values.php_fpm_prod.listen.mode }}

    user = {{ .Values.php_fpm_prod.user }}
    group = {{ .Values.php_fpm_prod.group }}

    pm = {{ .Values.php_fpm_prod.pm.type }}
    pm.max_children = {{ .Values.php_fpm_prod.pm.max_children }}
    pm.start_servers = {{ .Values.php_fpm_prod.pm.start_servers }}
    pm.min_spare_servers = {{ .Values.php_fpm_prod.pm.min_spare_servers }}
    pm.max_spare_servers = {{ .Values.php_fpm_prod.pm.max_spare_servers }}
    ;pm.max_requests = {{ .Values.php_fpm_prod.pm.max_requests }}
  nginx.conf: |
    user  nginx;
    #worker_processes  1;

    worker_processes auto;
    worker_priority -10;

    error_log  /dev/stderr;
    pid        /var/run/nginx.pid;

    events {
        worker_connections  4096;
    }


    http {
        include       /etc/nginx/mime.types;
        default_type  application/octet-stream;

        set_real_ip_from  10.0.0.0/8;
        set_real_ip_from  172.0.0.0/8;
        set_real_ip_from  192.168.0.0/16;

        real_ip_header X-Real-IP;
        real_ip_recursive on;

        log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                         '$status $body_bytes_sent "$http_referer" '
                         '"$http_user_agent" "$http_x_forwarded_for"';

        log_format combined_plus escape=json '{"time_local": "$time_local", '
                                            '"remote_addr": "$remote_addr", '
                                            '"remote_user": "$remote_user", '
                                            '"request": "$request", '
                                            '"status": "$status", '
                                            '"body_bytes_sent": "$body_bytes_sent", '
                                            '"request_time": "$request_time", '
                                            '"http_referrer": "$http_referer", '
                                            '"http_user_agent": "$http_user_agent"}';

        access_log  /dev/stdout combined_plus;

        sendfile        on;
        #tcp_nopush     on;

        keepalive_timeout  65;

        #gzip  on;

        include /etc/nginx/conf.d/*.conf;
    }
  nginx.default.conf: |
    server {
        listen 80;

        root        {{ .Values.ci_dir_home }}/stat/web/;
        index       index.php;

        disable_symlinks off;

        # old stat
        client_max_body_size 0;
        #proxy_connect_timeout 180s;
        #proxy_read_timeout 180s;
        #proxy_send_timeout 180s;

        # ingress params
        #client_max_body_size    2000M;
        proxy_connect_timeout   6000s;
        proxy_read_timeout      18000s;
        proxy_send_timeout      18000s;

        client_header_timeout 20m;
        client_body_timeout 20m;
        send_timeout 20m;
        connection_pool_size 512;
        client_header_buffer_size 10k;
        large_client_header_buffers 8 4k;
        request_pool_size 8k;
        server_tokens off;

        sendfile        on;
        #tcp_nopush     on;

        keepalive_timeout  0;

        #gzip  on;

        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        location ~ \.php$ {
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
            fastcgi_pass   127.0.0.1:9000;
            #fastcgi_pass unix:/var/run/php5-fpm.sock;
            fastcgi_read_timeout 8h;
            try_files $uri =404;
        }
{{ if eq (env "IS_WITH_COMET") "1" }}
        location {{ .Values.node_comet_prod.path }}/ {
            rewrite    {{ .Values.node_comet_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.node_comet_prod.host }}:{{ .Values.node_comet_prod.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /socket.io/ {
            #rewrite  /comet/socket.io/(.*)  /$1 break; #used to send request to base url
            #rewrite  /socket.io/(.*)  /$1 break; #used to send request to base url
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            #proxy_set_header X-Forwarded-Host $host;
            #proxy_set_header X-Forwarded-Server $host;
            proxy_set_header Host $http_host;
            proxy_set_header X-NginX-Proxy false;
            #proxy_set_header X-NginX-Proxy true;
            proxy_pass http://{{ .Values.node_comet_prod.host }}:{{ .Values.node_comet_prod.port }};
            proxy_redirect off;
            #proxy_pass_request_headers on;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
{{ end }}
{{ if eq (env "IS_WITH_BALANCE") "1" }}
        location {{ .Values.node_balance.path }}/ {
            rewrite    {{ .Values.node_balance.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.node_balance.host }}:{{ .Values.node_balance.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /socket.brs/ {
          #rewrite  /comet/socket.io/(.*)  /$1 break; #used to send request to base url
          #rewrite  /socket.io/(.*)  /$1 break; #used to send request to base url
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          #proxy_set_header X-Forwarded-Host $host;
          #proxy_set_header X-Forwarded-Server $host;
          proxy_set_header Host $http_host;
          proxy_set_header X-NginX-Proxy false;
          #proxy_set_header X-NginX-Proxy true;
          proxy_pass http://{{ .Values.node_balance.host }}:{{ .Values.node_balance.port }};
          proxy_redirect off;
          #proxy_pass_request_headers on;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
        }

{{ end }}
{{ if eq (env "IS_WITH_NNPPORTED") "1" }}
        location {{ .Values.node_nnp_ported_prod.path }}/ {
            rewrite    {{ .Values.node_nnp_ported_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.node_nnp_ported_prod.host }}:{{ .Values.node_nnp_ported_prod.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
{{ end }}
{{ if eq (env "IS_WITH_GRAPHQL") "1" }}
        location {{ .Values.graphql_prod.path }}/ {
            rewrite    {{ .Values.graphql_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.graphql_prod.host }}:{{ .Values.graphql_prod.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
{{ end }}
{{ if eq (int .redis_server.is_standalone) 0 }}
        location /redis-ha-stat/ {
            rewrite {{ .Values.redis_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.redis_prod.host }}:8080;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
{{ end }}
    }


#    server {
#        listen 8080;
#
#        root        {{ .Values.ci_dir_home }}/stat/web/;
#        index       index-test.php;
#
#        location / {
#            try_files $uri $uri/ /index-test.php?$args;
#        }
#
#        location ~ \.php$ {
#            include fastcgi_params;
#            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
#            fastcgi_pass   127.0.0.1:9000;
#            #fastcgi_pass unix:/var/run/php5-fpm.sock;
#            fastcgi_read_timeout 8h;
#            try_files $uri =404;
#        }
#    }
#
#
#    server {
#        listen 81;
#
#        root        {{ .Values.ci_dir_home }}/mailer/web/;
#        index       index.php;
#
#        location / {
#            try_files $uri $uri/ /index.php?$args;
#        }
#
#        location ~ \.php$ {
#            include fastcgi_params;
#            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
#            fastcgi_pass   127.0.0.1:9000;
#            #fastcgi_pass unix:/var/run/php5-fpm.sock;
#            fastcgi_read_timeout 8h;
#            try_files $uri =404;
#        }
#    }
#
#
#    server {
#        listen 8081;
#
#        root        {{ .Values.ci_dir_home }}/mailer/web/;
#        index       index-test.php;
#
#        location / {
#            try_files $uri $uri/ /index-test.php?$args;
#        }
#
#        location ~ \.php$ {
#            include fastcgi_params;
#            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
#            fastcgi_pass   127.0.0.1:9000;
#            #fastcgi_pass unix:/var/run/php5-fpm.sock;
#            fastcgi_read_timeout 8h;
#            try_files $uri =404;
#        }
#    }
  params.local.php: |
    <?php

    return [
        'adminEmail' => 'info@mcn.ru',
        'API_SECURE_KEY' => '{{ .params.api_secure_key }}',
        'CORE_SERVER' => '{{ .params.core_server }}',
        'PHONE_SERVER' => '{{ .params.phone_server }}',
        'VPBX_SERVER' => '{{ .params.phone_server }}',
        'VIRTPBX_URL' => 'https://[address]/vpbx/api/[action]',
        'VPBX_API_AUTHORIZATION' => [
            'method' => 'bearer',
            'token' => '{{ .Values.params_prod.token }}',
        ],
        'LK_PATH' => 'https://{{ .params.core_server }}/lk/',
        'FEEDBACK_SERVER' => '{{ .params.feedback_server }}',
        'FEEDBACK_API_KEY' => '{{ .Values.params_prod.feedback_api_key }}',
        'MAILER' => [
            'url' => 'http://mailer.local/',
            'auth' => [
                'method' => 'basic',
                'user' => '{{ .Values.params_prod.mailer_user }}',
                'passwd' => '{{ .Values.params_prod.mailer_password }}',
                'token' => '',
            ],
        ],
        'NOTIFICATION_TOKEN' => '{{ .Values.params_prod.notification_token }}',
        'sms_client' => '{{ .Values.params_prod.sms_gate.client }}',
        'sms_password' => '{{ .Values.params_prod.sms_gate.password }}',
        'sms_server' => '{{ .Values.params_prod.sms_gate.server }}',

        'monitoring_email' => '{{ .Values.params_prod.monitoring_email }}',
    {{ if eq .params.vps_is_enabled "1" }}
        'vps' => [
            'url' => 'https://ngtvm.mcn.ru:1500/vmmgr',
            'authinfo' => '{{ .Values.params_prod.vps_authinfo }}',
        ],
    {{ else }}
       /* VPS disabled */
    {{ end }}
    {{ if eq .params.sberbank_api_is_enabled "1" }}
        'SberbankApi' => [
            \app\models\Organization::MCN_TELECOM => [
                'user' => '{{ .Values.params_prod.sberbank_api_sberbank_telecom_user }}',
                'password' => '{{ .Values.params_prod.sberbank_api_sberbank_telecom_password }}',
            ],
            \app\models\Organization::MCN_TELECOM_RETAIL => [
                'user' => '{{ .Values.params_prod.sberbank_api_sberbank_retail_user }}',
                'password' => '{{ .Values.params_prod.sberbank_api_sberbank_retail_password }}',
            ],
            \app\models\Organization::MCN_TELECOM_SERVICE => [
                'user' => '{{ .Values.params_prod.sberbank_api_sberbank_service_user }}',
                'password' => '{{ .Values.params_prod.sberbank_api_sberbank_service_password }}',
            ]
        ],
    {{ end }}
    /*
        'Cyberplat' => [
            'public_key' => 'cyberplat_public.key',
            'mcn_private_key' => 'mcn_telecom__private.key',
            'mcn_public_key' => 'mcn_telecom__public.key',
            'mcn_passhare' => 'mcn_telecom__passhare.key'
            //'mcn_private_key' => 'mcn_telecom_retail__private.key',
            //'mcn_public_key' => 'mcn_telecom_retail__public.key',
            //'mcn_passhare' => 'mcn_telecom_retail__passhare.key'
        ],
    */
        'PayPal' => [
            'default' => [ // TEL2TEL_KFT || TEL2TEL_LTD
                'user' => '{{ .Values.params_prod.paypal_default_user }}',
                'password' => '{{ .Values.params_prod.paypal_default_password }}',
                'signature' => '{{ .Values.params_prod.paypal_default_signature }}',
            ],
            \app\models\Organization::TEL2TEL_GMBH => [
                'user' => '{{ .Values.params_prod.paypal_tel2tel_user }}',
                'password' => '{{ .Values.params_prod.paypal_tel2tel_password }}',
                'signature' => '{{ .Values.params_prod.paypal_tel2tel_signature }}',
            ]
        ],
  
      {{ if eq .params.yandex_kassa_is_enabled "1" }}
        'yandex' => [
            'kassa' => [
                //\app\models\Organization::MCN_TELECOM_RETAIL => [
                //    'shop_id' => {{ .Values.params_prod.yandex_kassa_retail_shop_id }},
                //    'sc_id' => {{ .Values.params_prod.yandex_kassa_retail_sc_id }},
                //    'password' => '{{ .Values.params_prod.yandex_kassa_retail_password }}',
                //],
                \app\models\Organization::MCN_TELECOM => [
                    'shop_id' => {{ .Values.params_prod.yandex_kassa_telecom_shop_id }},
                    'sc_id' => {{ .Values.params_prod.yandex_kassa_telecom_sc_id }},
                    'password' => '{{ .Values.params_prod.yandex_kassa_telecom_password }}',
                ],
                \app\models\Organization::MCN_TELECOM_SERVICE => [
                    'shop_id' => {{ .Values.params_prod.yandex_kassa_service_shop_id }},
                    'sc_id' => {{ .Values.params_prod.yandex_kassa_service_sc_id }},
                    'password' => '{{ .Values.params_prod.yandex_kassa_service_password }}',
                ],
            ]
        ],
      {{ end }}


        'health' => [
            'externalUrls' => [
                'main' => [
                    // eridanus
                    //'Синхронизатор. Ошибки' => 'http://eridanus.mcn.ru/health/healthSyncLog.json',
                    //'Синхронизатор. Не запущен' => 'http://eridanus.mcn.ru/health/healthSyncProcess.json',
                    //'Синхронизатор. Не все синхронизировано' => 'http://eridanus.mcn.ru/health/healthFullSync.json',
                    //'sormSync' => 'http://eridanus.mcn.ru/health/healthSormSync.json',
                    ////'sormImport' => 'http://eridanus.mcn.ru/health/healthSormImport.json',
                    //'sormUpload' => 'http://eridanus.mcn.ru/health/healthSormUpload.json',
                    'SMS Errors' => 'http://thiamis.mcn.ru/sms/health/error.json',
                    'SMS Errors2' => 'http://thiamis.mcn.ru/sms/health/error2.json',

                    // stat heavy
                    // 'UuAccountEntry' => '@app/web/export/health/UuAccountEntry.json',
                    'UuBill' => '@app/web/export/health/UuBill.json',

                    // stat sh
                    'loadAverage' => '@app/web/export/health/loadAverage.json',
                    'apiFreeNumbers495' => '@app/web/export/health/apiFreeNumbers495.json',
                    'apiFreeNumbers499' => '@app/web/export/health/apiFreeNumbers499.json',
                    'apiFreeNumbersSilver' => '@app/web/export/health/apiFreeNumbersSilver.json',
                    'apiFreeNumbersAccount' => '@app/web/export/health/apiFreeNumbersAccount.json',
                    'ubillerLog' => '@app/web/export/health/ubillerLog.json',
                    'nnpPortedNumberLog' => '@app/web/export/health/nnpPortedNumberLog.json',
                    //'uuApiLog' => '@app/web/export/health/uuApiLog.json',
                    'mttLog' => '@app/web/export/health/mttLog.json',
                    'mttProcess' => '@app/web/export/health/mttProcess.json',
                    'tele2Log' => '@app/web/export/health/tele2Log.json',
                    'tele2Process' => '@app/web/export/health/tele2Process.json',
                    'portedNumberLog' => '@app/web/export/health/numberPortedLog.json',
                    'mailerLog' => '@app/web/export/health/mailerLog.json',
                    'mailerProcess' => '@app/web/export/health/mailerProcess.json',
                    'socketApi' => '@app/web/export/health/socketApi.json',
                    #'nnpPortedApi' => '@app/web/export/health/nnpPortedApi.json',
                    'handlerProcess' => '@app/web/export/health/handlerProcess.json',
                    'exportFreeNumbers' => '@app/web/export/health/exportFreeNumbers.json',
                    'DoublePayment' => '@app/web/export/health/DoublePayment.json',
                    'VoipDelayOnPackages' => '@app/web/export/health/VoipDelayOnPackages.json',
                    //'WrongNumberRegion' => '@app/web/export/health/WrongNumberRegion.json',
                    //'billerCleanMinEntry' => '@app/web/export/health/billerCleanMinEntry.json',
                ],
                'for_managers' => [
                    'SMS balance' => 'http://thiamis.mcn.ru/sms/health/balance.json',
                    'UuTestTariff' => '@app/web/export/health/UuTestTariff.json',
                    'UuShiftTariff' => '@app/web/export/health/UuShiftTariff.json',
                    //'SormClientsReg97' => '@app/web/export/health/SormClientsReg97.json',
                ]
            ],
            'export' => [
                'for_managers' => '@app/web/export/health/health_for_managers.json',
            ],
        ],
        'eventQueueIsUnderTheHighLoad' => false,
        'sormRegions' => [
            ['region_id' => 88, 'operator_id' => 15, 'number_prefix' => '7831235', 'datacenter_id' => 14],
            ['region_id' => 97, 'operator_id' => 3, 'number_prefix' => '7861', 'datacenter_id' => 5],
        ],
        'rocket_chat_token' => '{{ .Values.params_prod.rocket_chat_token }}',
        'nnpInfoServiceURL' => '{{ .Values.params_prod.nnp_info_service_url }}',
        'nnpMCNOperatorId' => 6720,
        'billerApiURL' => '{{ .Values.params_prod.biller_api_url }}',
        {{ if eq .params.client_changed_amq_settings "1" }}
        'clientChangedAmqSettings' => [
            'host' => '{{ .Values.params_prod.client_changed_amq_settings_host }}',
            'user' => '{{ .Values.params_prod.client_changed_amq_settings_user }}',
            'pass' => '{{ .Values.params_prod.client_changed_amq_settings_pass }}',
        ],
        {{ end }}
        {{ if eq .params.tele2_is_enabled "1" }}
        'Tele2AmqSettings' => [
            'host' => '{{ .params.tele2_amq_settings_host }}',
            'user' => '{{ .params.tele2_amq_settings_user }}',
            'pass' => '{{ .params.tele2_amq_settings_pass }}',
        ],
        {{ else }}
          /* tele2 disabled */
        {{ end }}
        'API_SERVER' => '{{ .params.api_mcn_server }}',
        'ROBOCALL_AUTH' => ['method' => 'bearer', 'token' => '{{ .Values.params_prod.robocall_auth_token }}'],
        'ROBOCALL_DEFAULT_PARAMS' => ['task_id' =>  253, 'account_id' => 47197, 'robocall_id' => 9],
        'CALLTRACKING_SERVER' => '{{ .params.calltracking_server }}',
        'ROBOCALL_INTERNAL_SERVER' => '{{ .params.robocall_internal_server }}',
    ];

  local.conf.php: |
    <?php

    return array(
            'WEB_PATH'            =>    '/',
            'WEB_ADDRESS'        => 'https://stat.mcn.ru/',
            'USE_MD5'        => 1, //использование md5-хеширование для паролей

            /* voip regions db */
            'R_CALLS_HOST'		=>	'reg[region].mcntelecom.ru',
            'R_CALLS_USER'		=>	'{{ .Values.params_local.db_voip_regions_r_calls_user }}',
            'R_CALLS_PASS'		=>	'{{ .Values.params_local.db_voip_regions_r_calls_pass }}',
            'R_CALLS_DB'		=>	'nispd[region]',

            /* voip moscow db */
            'R_CALLS_99_HOST'		=>	'85.94.32.237',
            'R_CALLS_99_USER'		=>	'{{ .Values.params_local.db_voip_moscow_r_calls_99_user }}',
            'R_CALLS_99_PASS'		=>	'{{ .Values.params_local.db_voip_moscow_r_calls_99_pass }}',
            'R_CALLS_99_DB'		=>	'nispd',


            /* welltime db */
            'EXT_SQL_HOST'		=>  'thiamis.mcn.ru',
            'EXT_SQL_USER'		=>  '{{ .Values.params_local.db_welltime_ext_sql_user }}',
            'EXT_SQL_PASS'		=>  '{{ .Values.params_local.db_welltime_ext_sql_pass }}',
            'EXT_SQL_DB'		=>  'welltone_new3',
            'EXT_GROUP_ID'		=>  6,

            /* sync with lk */
            'MONGO_HOST' => '{{ .params.phone_server }}',
            'MONGO_USER' => '{{ .Values.params_local.sync_with_lk_mongo_user }}',
            'MONGO_PASS' => '{{ .Values.params_local.sync_with_lk_mongo_pass }}',
            'MONGO_DB' => 'lkmcn',

            /* sync with 1c */
            'SYNC1C_UT_SOAP_URL'  => '{{ .params.sync1c_ut_soap_url }}',
            'SYNC1C_UT_LOGIN'     => '{{ .Values.params_local.sync1c_ut_login }}',
            'SYNC1C_UT_PASSWORD'  => '{{ .Values.params_local.sync1c_ut_password }}',
            'SYNC1C_STAT_TOKEN'   => '{{ .Values.params_local.sync1c_stat_token }}',

            "LOG_DIR"           => "/var/log/nispd/",
            "SCAN_DOC_DIR"      => realpath(\Yii::getAlias('@app') . '/../store/skanpdf') . '/',

            "CORE_API_URL"      => "https://{{ .params.core_server }}/core/api/",
            "CORE_SERVER"      => "{{ .params.core_server }}",
            "PHONE_SERVER"      => "{{ .params.phone_server }}",

            "VIRTPBX_TEST_ADDRESS" => "{{ .params.phone_server }}",
            "VIRTPBX_URL" => "https://[address]/vpbx/api/[action]",
            //'API__print_bill_url' => 'https://lk.mcn.ru/lk/docs/?bill=', //'https://lk.mcn.ru/print?bill='
            'API__print_bill_url' => '/lk/docs/?bill=', //'https://lk.mcn.ru/print?bill='

            "LK_PATH" => "https://lk.mcn.ru/lk/",
            "AUTOCREATE_SIP_ACCOUNT" => 1, //автоматическое создание учеток при заведении номера
            "AUTOCREATE_VPBX" => 1,// автоматическое создание vpbx после включения услуги
            "ADMIN_EMAIL" => "{{ .Values.params_local.admin_email }}",
            "ADMIN_PHONE" => "{{ .Values.params_local.admin_phone }}",
            "MONITORING_EMAIL" => "{{ .Values.params_local.monitoring_email }}",

            "TEST_NOTICE" => 1, //тестирование отправки оповещений

            "use_ats3" => 1,

              'WELLTIME_INTEGRATION' => true

            );

  node-comet-config.json: |
    {
      "port": {{ .Values.node_comet_prod.port }},
      "logLevel": {{ .Values.node_comet_prod.logLevel }},
      "secretKey": {{ .Values.node_comet_prod.secret_key | quote }}
    }

  node-nnp-ported-config.json: |
    {
      "port": {{ .Values.node_nnp_ported_prod.port }},
      "logLevel": {{ .Values.node_nnp_ported_prod.logLevel }},
      "connectionString": {{ .Values.node_nnp_ported_prod.connection_string | quote }},
      "getNumberRangeUrl": {{ .Values.node_nnp_ported_prod.get_url | quote }},
      "redisOptions": {
        "host": {{ .Values.redis_prod.host | quote }}
      }
    }

  cryptopro-start.sh: |
    #!/bin/bash

    # Установка Лицензии МСН Телеком на программу КриптоПро
    # Просмотр лицензии /opt/cprocsp/sbin/amd64/cpconfig -license -view
    /opt/cprocsp/sbin/amd64/cpconfig -license -set {{ .Values.cryptopro_prod.license }}

    # Экспорт сертификатов из конфигмап Кубернейтиса.
    # Просмотр командой /opt/cprocsp/bin/amd64/certmgr -list
    wget --user={{ .Values.cryptopro_prod.remote_crt_user }} --password={{ .Values.cryptopro_prod.remote_crt_password }} {{ .Values.cryptopro_prod.remote_crt_url }}
    tar xf crt.tar.gz crt/
    cp -rp /root/crt/* /var/opt/cprocsp/keys/root/
    echo 1|/opt/cprocsp/bin/amd64/cryptcp -CSPcert
    echo 2|/opt/cprocsp/bin/amd64/cryptcp -CSPcert

    mkdir /root/.ssh

    cp -rp /root/id_rsa.pub /root/.ssh/authorized_keys
    cp -rp /root/id_rsa /etc/ssh/ssh_host_rsa_key

    chmod 600 /etc/ssh/ssh_host_rsa_key /root/.ssh/authorized_keys

    /usr/sbin/sshd -D

  cryptopro-id_rsa: |
{{ .Values.cryptopro_prod.id_rsa | indent 4 }}

  php-fpm-cryptopro-id_rsa.pub: |
    {{ .Values.cryptopro_prod.id_rsa_pub }}

  php-fpm-cryptopro-known_hosts: |
    {{ .Values.cryptopro_prod.known_hosts }}

  graphql-engine.sh: |
    #!/bin/sh

    /bin/graphql-engine serve

    /bin/sleep infinity