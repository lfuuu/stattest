{{ $_ := set . "params" .Values.params_dev }}

{{- if (eq (env "ENVNAME") "prod") }}
  {{ $_ := set . "params" (ternary .Values.params_prod_eu .Values.params_prod (eq (env "COUNTRY") "EU")) }}
{{- end }}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-config-files
data:
{{- if (eq (env "ENVNAME") "dev") }}
  .pgpass: |
{{ .Files.Get ".werf/tmp/.pgpass" | indent 8 }}
{{- end }}
  php.ini: |
    [PHP]
    SMTP = mail.mcn.ru
    sendmail_path = /usr/sbin/sendmail -S mail.mcn.ru -t -i -f root@tiberis.mcn.ru

    output_buffering = 4096
    expose_php = Off
    max_execution_time = 36000
    max_input_time = 36000
    max_input_vars = 100000
    memory_limit = 4G
    post_max_size = 100M
    upload_max_filesize = 1G
    serialize_precision = -1
    precision = -1
    short_open_tag = On

    error_reporting = {{ .Values.php_prod.error_reporting }}
    display_errors = {{ .Values.php_prod.display_errors }}
    display_startup_errors = {{ .Values.php_prod.display_startup_errors }}

    enable_dl = {{ .Values.php_prod.enable_dl }}

    log_errors = {{ .Values.php_prod.log_errors }}
    error_log = {{ .Values.php_prod.error_log }}

    report_memleaks = {{ .Values.php_prod.report_memleaks }}

    variables_order = {{ .Values.php_prod.variables_order | quote }}
    request_order = {{ .Values.php_prod.request_order | quote }}
    date.timezone = {{ .Values.php_prod.date.timezone | quote }}

    [Session]
    session.save_path = {{ .Values.php_prod.session.save_path }}
    session.gc_maxlifetime = {{ .Values.php_prod.session.gc_maxlifetime }}
    session.gc_probability = {{ .Values.php_prod.session.gc_probability }}

  php-fpm.www.conf: |
    [www]
    listen = {{ .Values.php_fpm_prod.listen.to }}
    ;listen.allowed_clients = {{ .Values.php_fpm_prod.listen.allowed_clients }}
    listen.owner = {{ .Values.php_fpm_prod.listen.owner }}
    listen.group = {{ .Values.php_fpm_prod.listen.group }}
    ;listen.mode = {{ .Values.php_fpm_prod.listen.mode }}

    user = {{ .Values.php_fpm_prod.user }}
    group = {{ .Values.php_fpm_prod.group }}

    pm = {{ .Values.php_fpm_prod.pm.type }}
    pm.max_children = {{ .Values.php_fpm_prod.pm.max_children }}
    pm.start_servers = {{ .Values.php_fpm_prod.pm.start_servers }}
    pm.min_spare_servers = {{ .Values.php_fpm_prod.pm.min_spare_servers }}
    pm.max_spare_servers = {{ .Values.php_fpm_prod.pm.max_spare_servers }}
    ;pm.max_requests = {{ .Values.php_fpm_prod.pm.max_requests }}
  nginx.conf: |
    user  nginx;
    #worker_processes  1;

    worker_processes auto;
    worker_priority -10;

    error_log  /dev/stderr;
    pid        /var/run/nginx.pid;

    events {
        worker_connections  4096;
    }


    http {
        include       /etc/nginx/mime.types;
        default_type  application/octet-stream;

        set_real_ip_from  10.0.0.0/8;
        set_real_ip_from  15.0.0.0/8;
        set_real_ip_from  172.0.0.0/8;
        set_real_ip_from  192.168.0.0/16;

        real_ip_header X-Real-IP;
        real_ip_recursive on;

        log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                         '$status $body_bytes_sent "$http_referer" '
                         '"$http_user_agent" "$http_x_forwarded_for"';

        log_format combined_plus escape=json '{"time_local": "$time_local", '
                                            '"remote_addr": "$remote_addr", '
                                            '"remote_user": "$remote_user", '
                                            '"request": "$request", '
                                            '"status": "$status", '
                                            '"body_bytes_sent": "$body_bytes_sent", '
                                            '"request_time": "$request_time", '
                                            '"http_referrer": "$http_referer", '
                                            '"http_user_agent": "$http_user_agent"}';

        access_log  /dev/stdout combined_plus;

        sendfile        on;
        #tcp_nopush     on;

        keepalive_timeout  65;

        #gzip  on;

        include /etc/nginx/conf.d/*.conf;
    }
  nginx.default.conf: |
    server {
        listen 80;

        root        {{ .Values.ci_dir_home }}/stat/web/;
        index       index.php;

        disable_symlinks off;

        # old stat
        proxy_connect_timeout 3600;
        proxy_read_timeout 3600;
        proxy_send_timeout 3600;

        # ingress params
        client_max_body_size    100M;

        client_header_timeout 3600;
        client_body_timeout 3600;
        send_timeout 3600;
        connection_pool_size 512;
        client_header_buffer_size 10k;
        large_client_header_buffers 8 4k;
        request_pool_size 8k;
        server_tokens off;

        sendfile        on;
        #tcp_nopush     on;

        keepalive_timeout  0;

        #gzip  on;

        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        location ~ \.php$ {
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
            fastcgi_pass   127.0.0.1:9000;
            #fastcgi_pass unix:/var/run/php5-fpm.sock;
            fastcgi_read_timeout 3600;
            fastcgi_send_timeout 3600;
            try_files $uri =404;
        }
{{ if eq (env "IS_WITH_COMET") "1" }}
        location {{ .Values.node_comet_prod.path }}/ {
            rewrite    {{ .Values.node_comet_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.node_comet_prod.host }}:{{ .Values.node_comet_prod.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /socket.io/ {
            #rewrite  /comet/socket.io/(.*)  /$1 break; #used to send request to base url
            #rewrite  /socket.io/(.*)  /$1 break; #used to send request to base url
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            #proxy_set_header X-Forwarded-Host $host;
            #proxy_set_header X-Forwarded-Server $host;
            proxy_set_header Host $http_host;
            proxy_set_header X-NginX-Proxy false;
            #proxy_set_header X-NginX-Proxy true;
            proxy_pass http://{{ .Values.node_comet_prod.host }}:{{ .Values.node_comet_prod.port }};
            proxy_redirect off;
            #proxy_pass_request_headers on;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
  
            access_log off;
        }
{{ end }}
{{ if eq (env "IS_WITH_BALANCE") "1" }}
        location {{ .Values.node_balance.path }}/ {
            rewrite    {{ .Values.node_balance.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.node_balance.host }}:{{ .Values.node_balance.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /socket.brs/ {
          #rewrite  /comet/socket.io/(.*)  /$1 break; #used to send request to base url
          #rewrite  /socket.io/(.*)  /$1 break; #used to send request to base url
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          #proxy_set_header X-Forwarded-Host $host;
          #proxy_set_header X-Forwarded-Server $host;
          proxy_set_header Host $http_host;
          proxy_set_header X-NginX-Proxy false;
          #proxy_set_header X-NginX-Proxy true;
          proxy_pass http://{{ .Values.node_balance.host }}:{{ .Values.node_balance.port }};
          proxy_redirect off;
          #proxy_pass_request_headers on;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
        }

{{ end }}
{{ if eq (env "IS_WITH_NNPPORTED") "1" }}
        location {{ .Values.node_nnp_ported_prod.path }}/ {
            rewrite    {{ .Values.node_nnp_ported_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.node_nnp_ported_prod.host }}:{{ .Values.node_nnp_ported_prod.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
{{ end }}
{{ if eq (env "IS_WITH_GRAPHQL") "1" }}
        location {{ .Values.graphql_prod.path }}/ {
            rewrite    {{ .Values.graphql_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.graphql_prod.host }}:{{ .Values.graphql_prod.port }};
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
{{ end }}
{{ if and (eq (int .redis_server.is_standalone) 0) (eq (env "COUNTRY") "EU") }}
        location /redis-ha-stat/ {
            rewrite {{ .Values.redis_prod.path }}/(.*) /$1 break; #used to send request to base url
            proxy_set_header Host $host;
            proxy_pass http://{{ .Values.redis_prod.host }}:8080;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
        }
{{ end }}
    }


#    server {
#        listen 8080;
#
#        root        {{ .Values.ci_dir_home }}/stat/web/;
#        index       index-test.php;
#
#        location / {
#            try_files $uri $uri/ /index-test.php?$args;
#        }
#
#        location ~ \.php$ {
#            include fastcgi_params;
#            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
#            fastcgi_pass   127.0.0.1:9000;
#            #fastcgi_pass unix:/var/run/php5-fpm.sock;
#            fastcgi_read_timeout 8h;
#            try_files $uri =404;
#        }
#    }
#
#
#    server {
#        listen 81;
#
#        root        {{ .Values.ci_dir_home }}/mailer/web/;
#        index       index.php;
#
#        location / {
#            try_files $uri $uri/ /index.php?$args;
#        }
#
#        location ~ \.php$ {
#            include fastcgi_params;
#            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
#            fastcgi_pass   127.0.0.1:9000;
#            #fastcgi_pass unix:/var/run/php5-fpm.sock;
#            fastcgi_read_timeout 8h;
#            try_files $uri =404;
#        }
#    }
#
#
#    server {
#        listen 8081;
#
#        root        {{ .Values.ci_dir_home }}/mailer/web/;
#        index       index-test.php;
#
#        location / {
#            try_files $uri $uri/ /index-test.php?$args;
#        }
#
#        location ~ \.php$ {
#            include fastcgi_params;
#            fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
#            fastcgi_pass   127.0.0.1:9000;
#            #fastcgi_pass unix:/var/run/php5-fpm.sock;
#            fastcgi_read_timeout 8h;
#            try_files $uri =404;
#        }
#    }
  params.local.php: |
    <?php

    return [
        'SITE_URL' => 'https://{{ .Values.ci_url }}/',
        'adminEmail' => 'info@mcn.ru',
        'API_SECURE_KEY' => '{{ .params.api_secure_key }}',
        'CORE_SERVER' => '{{ .params.core_server }}',
        'PHONE_SERVER' => '{{ .params.phone_server }}',
        'VPBX_SERVER' => '{{ .params.phone_server }}',
        'BASE_SERVER' => '{{ .params.base_server }}',
        'VIRTPBX_URL' => 'https://[address]/vpbx/api/[action]',
        'VPBX_API_AUTHORIZATION' => [
            'method' => 'bearer',
            'token' => '{{ .Values.params_prod.token }}',
        ],
        'LK_PATH' => 'https://{{ .params.core_server }}/lk/',
        'FEEDBACK_SERVER' => '{{ .params.feedback_server }}',
        'FEEDBACK_API_KEY' => '{{ .Values.params_prod.feedback_api_key }}',
        {{- if (eq (env "ENVNAME") "prod") }}
        {{ $_ := set . "ebc_kafka" (ternary .Values.ebc_kafka_prod_eu .Values.ebc_kafka_prod (eq (env "COUNTRY") "EU")) }}
        'KAFKA_BROKERS' => '{{ .ebc_kafka.brokers }}',
        'IS_KAFKA_WITH_SSL' => {{ ternary true false (eq .ebc_kafka.is_with_ssl "1") }},
        {{ end }}
        'MAILER' => [
            'url' => 'http://{{ printf "mailer-processor-service-%s-%s-%s" .Chart.Name (env "ENVNAME" | lower) (env "COUNTRY" | lower) }}/',
            'auth' => [
                'method' => 'basic',
                'user' => '{{ .Values.params_prod.mailer_user }}',
                'passwd' => '{{ .Values.params_prod.mailer_password }}',
                'token' => '',
            ],
        ],
        'NOTIFICATION_TOKEN' => '{{ .Values.params_prod.notification_token }}',
        'sms_client' => '{{ .Values.params_prod.sms_gate.client }}',
        'sms_password' => '{{ .Values.params_prod.sms_gate.password }}',
        'sms_server' => '{{ .Values.params_prod.sms_gate.server }}',

        'monitoring_email' => '{{ .Values.params_prod.monitoring_email }}',
    {{ if eq .params.vps_is_enabled "1" }}
        'vps' => [
            'url' => 'https://ngtvm.mcn.ru:1500/vmmgr',
            'authinfo' => '{{ .Values.params_prod.vps_authinfo }}',
        ],
    {{ else }}
       /* VPS disabled */
    {{ end }}
    {{ if eq .params.sberbank_api_is_enabled "1" }}
        'SberbankApi' => [
            \app\models\Organization::MCN_TELECOM => [
                'user' => '{{ .Values.params_prod.sberbank_api_sberbank_telecom_user }}',
                'password' => '{{ .Values.params_prod.sberbank_api_sberbank_telecom_password }}',
            ],
            \app\models\Organization::MCN_TELECOM_RETAIL => [
                'user' => '{{ .Values.params_prod.sberbank_api_sberbank_retail_user }}',
                'password' => '{{ .Values.params_prod.sberbank_api_sberbank_retail_password }}',
            ],
            \app\models\Organization::MCN_TELECOM_SERVICE => [
                'user' => '{{ .Values.params_prod.sberbank_api_sberbank_service_user }}',
                'password' => '{{ .Values.params_prod.sberbank_api_sberbank_service_password }}',
            ]
        ],
    {{ end }}
    /*
        'Cyberplat' => [
            'public_key' => 'cyberplat_public.key',
            'mcn_private_key' => 'mcn_telecom__private.key',
            'mcn_public_key' => 'mcn_telecom__public.key',
            'mcn_passhare' => 'mcn_telecom__passhare.key'
            //'mcn_private_key' => 'mcn_telecom_retail__private.key',
            //'mcn_public_key' => 'mcn_telecom_retail__public.key',
            //'mcn_passhare' => 'mcn_telecom_retail__passhare.key'
        ],
    */
        'PayPal' => [
            'default' => [ // TEL2TEL_KFT || TEL2TEL_LTD
                'user' => '{{ .Values.params_prod.paypal_default_user }}',
                'password' => '{{ .Values.params_prod.paypal_default_password }}',
                'signature' => '{{ .Values.params_prod.paypal_default_signature }}',
            ],
            \app\models\Organization::TEL2TEL_GMBH => [
                'user' => '{{ .Values.params_prod.paypal_tel2tel_user }}',
                'password' => '{{ .Values.params_prod.paypal_tel2tel_password }}',
                'signature' => '{{ .Values.params_prod.paypal_tel2tel_signature }}',
            ]
        ],
  
      {{ if eq .params.yandex_kassa_is_enabled "1" }}
        'yandex' => [
            'kassa' => [
                //\app\models\Organization::MCN_TELECOM_RETAIL => [
                //    'shop_id' => {{ .Values.params_prod.yandex_kassa_retail_shop_id }},
                //    'sc_id' => {{ .Values.params_prod.yandex_kassa_retail_sc_id }},
                //    'password' => '{{ .Values.params_prod.yandex_kassa_retail_password }}',
                //],
                \app\models\Organization::MCN_TELECOM => [
                    'shop_id' => {{ .Values.params_prod.yandex_kassa_telecom_shop_id }},
                    'sc_id' => {{ .Values.params_prod.yandex_kassa_telecom_sc_id }},
                    'password' => '{{ .Values.params_prod.yandex_kassa_telecom_password }}',
                ],
                \app\models\Organization::MCN_TELECOM_SERVICE => [
                    'shop_id' => {{ .Values.params_prod.yandex_kassa_service_shop_id }},
                    'sc_id' => {{ .Values.params_prod.yandex_kassa_service_sc_id }},
                    'password' => '{{ .Values.params_prod.yandex_kassa_service_password }}',
                ],
            ]
        ],
      {{ end }}


        'health' => [
            'externalUrls' => [
                'main' => [
                    // eridanus
                    //'Синхронизатор. Ошибки' => 'http://eridanus.mcn.ru/health/healthSyncLog.json',
                    //'Синхронизатор. Не запущен' => 'http://eridanus.mcn.ru/health/healthSyncProcess.json',
                    //'Синхронизатор. Не все синхронизировано' => 'http://eridanus.mcn.ru/health/healthFullSync.json',
                    //'sormSync' => 'http://eridanus.mcn.ru/health/healthSormSync.json',
                    ////'sormImport' => 'http://eridanus.mcn.ru/health/healthSormImport.json',
                    //'sormUpload' => 'http://eridanus.mcn.ru/health/healthSormUpload.json',
                    // 'SMS Errors' => 'http://thiamis.mcn.ru/sms/health/error.json',
                    // 'SMS Errors2' => 'http://thiamis.mcn.ru/sms/health/error2.json',

                    // stat heavy
                    // 'UuAccountEntry' => '@app/web/export/health/UuAccountEntry.json',
                    {{ if (eq (env "COUNTRY") "RU") }}
                    'UuBill' => '@app/web/export/health/UuBill.json',

                    // stat sh
                    'loadAverage' => '@app/web/export/health/loadAverage.json',
                    'apiFreeNumbers495' => '@app/web/export/health/apiFreeNumbers495.json',
                    'apiFreeNumbers499' => '@app/web/export/health/apiFreeNumbers499.json',
                    'apiFreeNumbersSilver' => '@app/web/export/health/apiFreeNumbersSilver.json',
                    'apiFreeNumbersAccount' => '@app/web/export/health/apiFreeNumbersAccount.json',
                    'ubillerLog' => '@app/web/export/health/ubillerLog.json',
                    'nnpPortedNumberLog' => '@app/web/export/health/nnpPortedNumberLog.json',
                    //'uuApiLog' => '@app/web/export/health/uuApiLog.json',
                    // 'mttLog' => '@app/web/export/health/mttLog.json',
                    // 'mttProcess' => '@app/web/export/health/mttProcess.json',
                    'tele2Log' => '@app/web/export/health/tele2Log.json',
                    'tele2Process' => '@app/web/export/health/tele2Process.json',
                    'portedNumberLog' => '@app/web/export/health/numberPortedLog.json',
                    'mailerLog' => '@app/web/export/health/mailerLog.json',
                    'mailerProcess' => '@app/web/export/health/mailerProcess.json',
                    'socketApi' => '@app/web/export/health/socketApi.json',
                    #'nnpPortedApi' => '@app/web/export/health/nnpPortedApi.json',
                    'handlerProcess' => '@app/web/export/health/handlerProcess.json',
                    'exportFreeNumbers' => '@app/web/export/health/exportFreeNumbers.json',
                    'DoublePayment' => '@app/web/export/health/DoublePayment.json',
                    'VoipDelayOnPackages' => '@app/web/export/health/VoipDelayOnPackages.json',
                    {{ end }}
                    //'WrongNumberRegion' => '@app/web/export/health/WrongNumberRegion.json',
                    //'billerCleanMinEntry' => '@app/web/export/health/billerCleanMinEntry.json',
                ],
                'for_managers' => [
                     {{ if (eq (env "COUNTRY") "RU") }}
                    'SMS balance' => 'http://thiamis.mcn.ru/sms/health/balance.json',
                    'UuTestTariff' => '@app/web/export/health/UuTestTariff.json',
                    'UuShiftTariff' => '@app/web/export/health/UuShiftTariff.json',
                    {{ end }}
                    //'SormClientsReg97' => '@app/web/export/health/SormClientsReg97.json',
                ]
            ],
            'export' => [
                'for_managers' => '@app/web/export/health/health_for_managers.json',
            ],
        ],
        'eventQueueIsUnderTheHighLoad' => false,
        'sormRegions' => [
            ['region_id' => 88, 'operator_id' => 15, 'number_prefix' => '7831235', 'datacenter_id' => 14],
            ['region_id' => 97, 'operator_id' => 3, 'number_prefix' => '7861', 'datacenter_id' => 5],
        ],
        'rocket_chat_token' => '{{ .params.rocket_chat_token }}',
        'matrix_notifier_token' => '{{ .params.matrix_notifier_token }}',
        'nnpInfoServiceURL' => '{{ .params.nnp_info_service_url }}',
        'nnpMCNOperatorId' => 6720,
        'billerApiURL' => '{{ .Values.params_prod.biller_api_url }}',
        {{ if eq .params.client_changed_amq_settings "1" }}
        'clientChangedAmqSettings' => [
            'host' => '{{ .Values.params_prod.client_changed_amq_settings_host }}',
            'user' => '{{ .Values.params_prod.client_changed_amq_settings_user }}',
            'pass' => '{{ .Values.params_prod.client_changed_amq_settings_pass }}',
        ],
        {{ end }}
        {{ if eq .params.tele2_is_enabled "1" }}
        'Tele2AmqSettings' => [
            'host' => '{{ .params.tele2_amq_settings_host }}',
            'user' => '{{ .params.tele2_amq_settings_user }}',
            'pass' => '{{ .params.tele2_amq_settings_pass }}',
        ],
        {{ else }}
          /* tele2 disabled */
        {{ end }}
        'API_SERVER' => '{{ .params.api_mcn_server }}',
        'ROBOCALL_AUTH' => ['method' => 'bearer', 'token' => '{{ .Values.params_prod.robocall_auth_token }}'],
        'ROBOCALL_DEFAULT_PARAMS' => ['task_id' =>  253, 'account_id' => 47197, 'robocall_id' => 9],
        'CALLTRACKING_SERVER' => '{{ .params.calltracking_server }}',
        'ROBOCALL_INTERNAL_SERVER' => '{{ .params.robocall_internal_server }}',
        {{ if ne .params.vmonitor.key1 "" }}
        'vmonitor' => [
          'key1' => '{{ .params.vmonitor.key1 }}',
          'key2' => '{{ .params.vmonitor.key2 }}',
        ],
        {{ end }}
    ];

  local.conf.php: |
    <?php

    return array(
            'WEB_PATH'            =>    '/',
            'WEB_ADDRESS'        => 'https://{{ .Values.ci_url }}/',
            'USE_MD5'        => 1, //использование md5-хеширование для паролей
            'SMTP_SERVER'       => '{{ .params.mailer.smtp.server }}',

            /* voip regions db */
            'R_CALLS_HOST'		=>	'reg[region].mcntelecom.ru',
            'R_CALLS_USER'		=>	'{{ .Values.params_local.db_voip_regions_r_calls_user }}',
            'R_CALLS_PASS'		=>	'{{ .Values.params_local.db_voip_regions_r_calls_pass }}',
            'R_CALLS_DB'		=>	'nispd[region]',

            /* voip moscow db */
            'R_CALLS_99_HOST'		=>	'85.94.32.237',
            'R_CALLS_99_USER'		=>	'{{ .Values.params_local.db_voip_moscow_r_calls_99_user }}',
            'R_CALLS_99_PASS'		=>	'{{ .Values.params_local.db_voip_moscow_r_calls_99_pass }}',
            'R_CALLS_99_DB'		=>	'nispd',


            /* welltime db */
            'EXT_SQL_HOST'		=>  'thiamis.mcn.ru',
            'EXT_SQL_USER'		=>  '{{ .Values.params_local.db_welltime_ext_sql_user }}',
            'EXT_SQL_PASS'		=>  '{{ .Values.params_local.db_welltime_ext_sql_pass }}',
            'EXT_SQL_DB'		=>  'welltone_new3',
            'EXT_GROUP_ID'		=>  6,

            /* sync with lk */
            'MONGO_HOST' => '{{ .params.phone_server }}',
            'MONGO_USER' => '{{ .Values.params_local.sync_with_lk_mongo_user }}',
            'MONGO_PASS' => '{{ .Values.params_local.sync_with_lk_mongo_pass }}',
            'MONGO_DB' => 'lkmcn',

            /* sync with 1c */
            'SYNC1C_UT_SOAP_URL'  => '{{ .params.sync1c_ut_soap_url }}',
            'SYNC1C_UT_LOGIN'     => '{{ .Values.params_local.sync1c_ut_login }}',
            'SYNC1C_UT_PASSWORD'  => '{{ .Values.params_local.sync1c_ut_password }}',
            'SYNC1C_STAT_TOKEN'   => '{{ .Values.params_local.sync1c_stat_token }}',

            "LOG_DIR"           => "/var/log/nispd/",
            "SCAN_DOC_DIR"      => realpath(\Yii::getAlias('@app') . '/../store/skanpdf') . '/',

            "CORE_API_URL"      => "https://{{ .params.core_server }}/core/api/",
            "CORE_SERVER"      => "{{ .params.core_server }}",
            "PHONE_SERVER"      => "{{ .params.phone_server }}",

            "VIRTPBX_TEST_ADDRESS" => "{{ .params.phone_server }}",
            "VIRTPBX_URL" => "https://[address]/vpbx/api/[action]",
            //'API__print_bill_url' => 'https://lk.mcn.ru/lk/docs/?bill=', //'https://lk.mcn.ru/print?bill='
            'API__print_bill_url' => '/lk/docs/?bill=', //'https://lk.mcn.ru/print?bill='

            "LK_PATH" => "https://lk.mcn.ru/lk/",
            "AUTOCREATE_SIP_ACCOUNT" => 1, //автоматическое создание учеток при заведении номера
            "AUTOCREATE_VPBX" => 1,// автоматическое создание vpbx после включения услуги
            "ADMIN_EMAIL" => "{{ .Values.params_local.admin_email }}",
            "ADMIN_PHONE" => "{{ .Values.params_local.admin_phone }}",
            "MONITORING_EMAIL" => "{{ .Values.params_local.monitoring_email }}",

            "TEST_NOTICE" => 1, //тестирование отправки оповещений

            "use_ats3" => 1,

              'WELLTIME_INTEGRATION' => true

            );

  node-comet-config.json: |
    {
      "port": {{ .Values.node_comet_prod.port }},
      "logLevel": {{ .Values.node_comet_prod.logLevel }},
      "secretKey": {{ .Values.node_comet_prod.secret_key | quote }}
    }

  node-nnp-ported-config.json: |
    {
      "port": {{ .Values.node_nnp_ported_prod.port }},
      "logLevel": {{ .Values.node_nnp_ported_prod.logLevel }},
      "connectionString": {{ .Values.node_nnp_ported_prod.connection_string | quote }},
      "getNumberRangeUrl": {{ .Values.node_nnp_ported_prod.get_url | quote }},
      "redisOptions": {
        "host": {{ .Values.redis_prod.host | quote }}
      }
    }

  cryptopro-start.sh: |
    #!/bin/bash

    # Установка Лицензии МСН Телеком на программу КриптоПро
    # Просмотр лицензии /opt/cprocsp/sbin/amd64/cpconfig -license -view
    /opt/cprocsp/sbin/amd64/cpconfig -license -set {{ .Values.cryptopro_prod.license }}

    # Экспорт сертификатов из конфигмап Кубернейтиса.
    # Просмотр командой /opt/cprocsp/bin/amd64/certmgr -list
    wget --user={{ .Values.cryptopro_prod.remote_crt_user }} --password={{ .Values.cryptopro_prod.remote_crt_password }} {{ .Values.cryptopro_prod.remote_crt_url }}
    tar xf crt.tar.gz crt/
    cp -rp /root/crt/* /var/opt/cprocsp/keys/root/
    echo 1|/opt/cprocsp/bin/amd64/cryptcp -CSPcert
    echo 2|/opt/cprocsp/bin/amd64/cryptcp -CSPcert

    mkdir /root/.ssh

    cp -rp /root/id_rsa.pub /root/.ssh/authorized_keys
    cp -rp /root/id_rsa /etc/ssh/ssh_host_rsa_key

    chmod 600 /etc/ssh/ssh_host_rsa_key /root/.ssh/authorized_keys

    /usr/sbin/sshd -D

  cryptopro-id_rsa: |
{{ .Values.cryptopro_prod.id_rsa | indent 4 }}

  php-fpm-cryptopro-id_rsa.pub: |
    {{ .Values.cryptopro_prod.id_rsa_pub }}

  php-fpm-cryptopro-known_hosts: |
{{ .Values.cryptopro_prod.known_hosts | indent 4 }}

  graphql-engine.sh: |
    #!/bin/sh

    /bin/graphql-engine serve

    /bin/sleep infinity

  crontab.file.original: |
    ####25 1 * * *     /etc/nispd/flows/flow-daily-run
    ###1 9 * * 1       /etc/nispd/flows/otchnulltraf.pl >>/var/log/otchnulltraf 2>>/var/log/nispd/otchnulltraf
  
    ###0 5 * * *      cd /home/httpd/stat.mcn.ru/include/stat/; php -c /etc/ autosaldo.php >> /var/log/nispd/autosaldo.log
    ###*/5 * * * *    cd /home/httpd/stat.mcn.ru/include/stat/; flock -w 3 /tmp/autoping python autoping.py 2>&1 >> /var/log/nispd/autoping.log
    ###50 4 * * *     cd /home/httpd/stat.mcn.ru/include/stat/; php -c /etc/ autotraffic.php --yesterday >> /var/log/nispd/autotraffic.log
    */5 * * * *    cd /home/httpd/stat.mcn.ru/include/stat/; flock -w 3 /tmp/automail php -c /etc/ automail.php >> /var/log/nispd/automail.log
    
    # voip day limits recalc
    ####0 8 * * *   cd /home/httpd/stat.mcn.ru/include/stat/; php -c /etc/ client_day_limit_set.php >> /var/log/nispd/client_day_limit_set.log 
    
    # установка свойств клиента, применяемые в будущем
    5 0 * * * cd /home/httpd/stat.mcn.ru/include/stat/; php -c /etc/ cron_client_prop.php >> /var/log/nispd/cron_client_prop.log
    
    # забор заявок OnLime
    #*/5 * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/onlime/; php -c /etc/ get_list.php  >> /var/log/nispd/onlime.log
    
    # снятие с резерва
    ##!##0 8 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/1c/; php -c /etc/ unreserv_orders.php  >> /var/log/nispd/unreserv.log
    
    # оповешение о минимальном кол-ве товара на складе
    ##!##0 9 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/goods/; php -c /etc/ store_limit.php  >> /var/log/nispd/store_limit.log
    
    # sms синхронизация
    ###10 0 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/sms/; php -c /etc/ replication.php  >> /var/log/nispd/sms_replication.log
    #*/5 * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/sms/; php -c /etc/ set_active.php  >> /var/log/nispd/sms_set_active.log
    
    ### забор статистики SMS
    10 2 * * * /home/httpd/stat.mcn.ru/stat/yii sms/get 2
    5  2 1 * * /home/httpd/stat.mcn.ru/stat/yii sms/get 31
    
    
    ### обновляем справочник переыва в услугах телефонии по москве
    #########59,29 * * * * /home/httpd/stat.mcn.ru/stat/yii number/fill-non-used-numbers
    * * * * * cd /home/httpd/stat.mcn.ru/stat/; ./yii sorm/export-redirects >> /var/log/nispd/sorm-export-redirects.log && ./yii sorm/group >> /var/log/nispd/sorm-export-redirect-groups.log
    
    #### heavy task manager
    * * * * * flock -w 3 /tmp/yii-task /home/httpd/stat.mcn.ru/stat/yii task >> /var/log/nispd/task.log
    
    ### Обновление lock'ов
    * * * * * flock -w 3 /tmp/yii-update-locks /home/httpd/stat.mcn.ru/stat/yii biller/update-locks >> /var/log/nispd/biller-update-locks.log
    
    10 2 * * * /home/httpd/stat.mcn.ru/stat/yii usage/client-update-is-active
    1 0 * * *  /home/httpd/stat.mcn.ru/stat/yii number/release-from-hold >> /var/log/nispd/release-from-hold.log
    2 0 * * *  /home/httpd/stat.mcn.ru/stat/yii number/actualize-numbers-by-usages >> /var/log/nispd/actualize-numbers-by-usages.log
    2 8 * * *  /home/httpd/stat.mcn.ru/stat/yii number/actualize-released 1 >> /var/log/nispd/actualize-numbers-released.log
    
    0 3 * * * flock -w 3 /tmp/yii-version-export /home/httpd/stat.mcn.ru/stat/yii version/export-current-versions >> /var/log/nispd/version-export.log
    1 0-3,15-23 * * * flock -w 3 /tmp/yii-usage-check-bill-overdue /home/httpd/stat.mcn.ru/stat/yii usage/check-bill-overdue >> /var/log/nispd/usage-check-bill-overdue.log
    59 23 * * *  /home/httpd/stat.mcn.ru/stat/yii usage/voip-test-clean >> /var/log/nispd/voip-test-clean.log
    0 7 * * * flock -w 3 /tmp/lk-set-is-lk-exists /home/httpd/stat.mcn.ru/stat/yii lk/set-is-lk-exists >> /var/log/nispd/lk-set-is-lk-exists.log
    0 * * * * flock -w 3 /tmp/number-actual-hourly /home/httpd/stat.mcn.ru/stat/yii number/actual-hourly >> /var/log/nispd/number-actual-hourly
    3 6 * * * flock -w 3 /tmp/number-actual-status-all /home/httpd/stat.mcn.ru/stat/yii number/actual-status-all 1 >> /var/log/nispd/number-actual-status-all
  
    #####3 5 * * *    /home/httpd/stat.mcn.ru/stat/yii number/preload-detail-report >> /var/log/nispd/preload-detail-report.log
  
    */3 * * * *  flock -w 3 /tmp/yii-check-voip-day-disable /home/httpd/stat.mcn.ru/stat/yii usage/check-voip-day-disable >> /var/log/nispd/check-voip-day-disable.log
    */3 * * * *  flock -w 3 /tmp/yii-check-notification /home/httpd/stat.mcn.ru/stat/yii lk/check-notification >> /var/log/nispd/check-notification.log
  
    ####! включить после решения проблем с сервереом постгреса !###
    */5 * * * *  flock -w 3 /tmp/yii-update-interop-counter /home/httpd/stat.mcn.ru/stat/yii number/update-interop-counter >> /var/log/nispd/update-interop-counter.log
    ###5 * * * *  flock -w 3 /tmp/yii-update-interop-counter /home/httpd/stat.mcn.ru/stat/yii number/update-interop-counter >> /var/log/nispd/update-interop-counter.log
    
    * * * * *  flock -w 3 /tmp/yii-tt-check-trouble-count-recal /home/httpd/stat.mcn.ru/stat/yii ticket/check-trouble-count-recal >> /var/log/nispd/tt-check-trouble-count-recal.log
    
    
    7 7 3 * *  flock -w 3 /tmp/yii-fill-nnp-to-redis /home/httpd/stat.mcn.ru/stat/yii number/full-nnp-to-redis >> /var/log/nispd/full-nnp-to-redis.log
    
    # прогнозирование блокировки по счету
    9 15 21-31 * *  flock -w 3 /tmp/yii-biller-forecast-account-block /home/httpd/stat.mcn.ru/stat/yii biller/forecast-account-block >> /var/log/nispd/forecast-account-block.log 2>&1
    
    3 0 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/voip; php -c /etc/ voipcheck.php >> /var/log/nispd/voipcheck.log
    0 5 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/voip; php -c /etc/ voipcheck.php >> /var/log/nispd/voipcheck.log
    
    5 6 * * * flock -w 3 /tmp/yii-number_calc-calls-per-month-0 /home/httpd/stat.mcn.ru/stat/yii number/calc-calls-per-month-0 >> /var/log/nispd/number-calls-per-month.log
    5 7 1 * * flock -w 3 /tmp/yii-number_calc-calls-per-month   /home/httpd/stat.mcn.ru/stat/yii number/calc-calls-per-month   >> /var/log/nispd/number-calls-per-month.log
    
    # Счетчики статистики
    2 0 2-31 * * flock -w 3 /tmp/yii-statistic-update /home/httpd/stat.mcn.ru/stat/yii statistic/update yesterday >> /var/log/nispd/stat-update.log
    2 0 1 * * flock -w 3 /tmp/yii-statistic-update /home/httpd/stat.mcn.ru/stat/yii statistic/update prevmonth >> /var/log/nispd/stat-update.log
    
    
    # Заполнение calls_raw_cache
    20 7 * * *  flock -w 3 /tmp/yii-calls_raw_cache /home/httpd/stat.mcn.ru/stat/yii calls-raw-cache/make-cache >> /var/log/nispd/calls_raw_cache.log
    25 8 * * * flock -w 3 /tmp/yii-calls-raw-unite /home/httpd/stat.mcn.ru/stat/yii calls-raw-unite/make-unite >> /var/log/nispd/calls_raw_unite.log
    
    0 6 * * * flock -w 3 /tmp/yii-nnp2-renew /home/httpd/stat.mcn.ru/stat/yii nnp2/range-short/renew >> /var/log/nispd/nnp2-renew.log
    
    # Выставление авансовых счетов операторам
    30 9 * * * flock -w 3 /tmp/yii-biller-advance-accounts /home/httpd/stat.mcn.ru/stat/yii biller/advance-accounts >> /var/log/nispd/biller-advance-accounts.log 2>&1
    
    # Перезабор данных о потребленных ресурсов с ВАТС.
    0 5 1 * * flock -w 3 /tmp/yii-vpbx-stat-get /home/httpd/stat.mcn.ru/stat/yii stat/vats/get prevmonth >> /var/log/nispd/vats-stat-prevmonth.log 2>&1
    10 8 * * *  /home/httpd/stat.mcn.ru/stat/yii stat/vats/get yesterday >> /var/log/nispd/cron_vats_stat.log
    10 18 * * *  /home/httpd/stat.mcn.ru/stat/yii stat/vats/get yesterday >> /var/log/nispd/cron_vats_stat.log
    
    # обновление таблицы uu_account_tariff_voip_flat
    0 7 * * * /home/httpd/stat.mcn.ru/stat/yii uu/account-tariff-voip-flat/generate
    
    # Завершение сбербанковских платежей
    * * * * * flock -w 3 /tmp/yii-sberbank-orders-finishing /home/httpd/stat.mcn.ru/stat/yii biller/sberbank-orders-finishing >> /var/log/nispd/sberbank-orders-finishing.log
    
    
    # Универсальные услуги
    10 0-5,15-23 * * * flock -w 3 /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log 2>&1
    
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1 200000 >> /var/log/nispd/ubiller.log.11
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 200001 300000 >> /var/log/nispd/ubiller.log.12
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 300001 400000 >> /var/log/nispd/ubiller.log.13
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 400001 500000 >> /var/log/nispd/ubiller.log.14
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 500001 600000 >> /var/log/nispd/ubiller.log.15
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 600001 700000 >> /var/log/nispd/ubiller.log.16
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 700001 800000 >> /var/log/nispd/ubiller.log.17
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 800001 900000 >> /var/log/nispd/ubiller.log.18
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 900001 1000000 >> /var/log/nispd/ubiller.log.19
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1000001 1100000 >> /var/log/nispd/ubiller.log.20
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1100001 1200000 >> /var/log/nispd/ubiller.log.21
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1200001 1300000 >> /var/log/nispd/ubiller.log.22
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1300001 1400000 >> /var/log/nispd/ubiller.log.23
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1400001 1500000 >> /var/log/nispd/ubiller.log.24
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1500001 1600000 >> /var/log/nispd/ubiller.log.25
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1600001 1700000 >> /var/log/nispd/ubiller.log.25
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1700001 1800000 >> /var/log/nispd/ubiller.log.25
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1800001 1900000 >> /var/log/nispd/ubiller.log.25
    2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1900001 2000000 >> /var/log/nispd/ubiller.log.25
    3 23 28-31 * * flock -w 8000 /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log
    
    
    
    ###19 6 * * * /home/jenkins/kill_ubiller.sh >> /var/log/nispd/kubiller.log
    ###39 13 * * * /home/jenkins/kill_ubiller.sh >> /var/log/nispd/ubiller.log
    29 5 * * *                                   /home/httpd/stat.mcn.ru/stat/yii param/set stop_ubiller_flag 1 >> /var/log/nispd/ubiller.log
    29 5 * * *                                   /home/httpd/stat.mcn.ru/stat/yii ubiller/prepare-resource-calc 15 >> /var/log/nispd/ubiller.log
    29 5 * * * flock -w 3    -x /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/set-and-sync-tariff >> /var/log/nispd/ubiller.log
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p1 >> /var/log/nispd/ubiller.log.11
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p2 >> /var/log/nispd/ubiller.log.12
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p3 >> /var/log/nispd/ubiller.log.13
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p4 >> /var/log/nispd/ubiller.log.14
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p5 >> /var/log/nispd/ubiller.log.15
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p6 >> /var/log/nispd/ubiller.log.16
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p7 >> /var/log/nispd/ubiller.log.17
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p8 >> /var/log/nispd/ubiller.log.18
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p9 >> /var/log/nispd/ubiller.log.19
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p10 >> /var/log/nispd/ubiller.log.20
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p11 >> /var/log/nispd/ubiller.log.21
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p12 >> /var/log/nispd/ubiller.log.22
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p13 >> /var/log/nispd/ubiller.log.23
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p14 >> /var/log/nispd/ubiller.log.24
    30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p15 >> /var/log/nispd/ubiller.log.25
    31 5 * * * flock -w 8000 -x /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log
    
    
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p1 >> /var/log/nispd/ubiller.log.11
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p2 >> /var/log/nispd/ubiller.log.12
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p3 >> /var/log/nispd/ubiller.log.13
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p4 >> /var/log/nispd/ubiller.log.14
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p5 >> /var/log/nispd/ubiller.log.15
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p6 >> /var/log/nispd/ubiller.log.16
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p7 >> /var/log/nispd/ubiller.log.17
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p8 >> /var/log/nispd/ubiller.log.18
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p9 >> /var/log/nispd/ubiller.log.19
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p10 >> /var/log/nispd/ubiller.log.20
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p11 >> /var/log/nispd/ubiller.log.21
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p12 >> /var/log/nispd/ubiller.log.22
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p13 >> /var/log/nispd/ubiller.log.23
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p14 >> /var/log/nispd/ubiller.log.24
    34 13 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p15 >> /var/log/nispd/ubiller.log.25
    35 13 * * * flock -w 8000 -x /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log
    
    
    5 6 2 * * time flock -w 5000 /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/clean-up >> /var/log/nispd/ubiller.log
    1 0 * * * time flock -w 3 /tmp/yii-ubiller-margin /home/httpd/stat.mcn.ru/stat/yii ubiller/fill-margins >> /var/log/nispd/margin.log 2>&1
    
    
    
    # МТТ (интернет-трафик)
    ####* * * * * flock -w 3 /tmp/yii-mtt timeout 1h /home/httpd/stat.mcn.ru/stat/yii mtt/daemon/run >> /var/log/nispd/mtt.log 2>&1
    # Tele2 привязка IMSI
    * * * * * flock -w 3 /tmp/yii-tele2 timeout 1h /home/httpd/stat.mcn.ru/stat/yii usage/run-tele2-daemon >> /var/log/nispd/tele2.log 2>&1
    
    # ННП (импортировать Россвязь раз в месяц)
    ##!##27 7 5 * * cd /home/httpd/stat.mcn.ru/stat; ./yii nnp/import/disable-trigger; ./yii nnp/import/rus >> /var/log/nispd/nnp_import_rus.log 2>&1
    
    # Экспорт free-numbers
    44 * * * * cd /home/httpd/stat.mcn.ru/stat/modules/freeNumber; ./export.sh
    
    ### Парнетры ####
    # Расчет партнерского вознаграждения
    ###30 0 * * * flock -w 3 /tmp/yii-partner-reward /home/httpd/stat.mcn.ru/stat/yii partner-reward/calculate-rewards-for-1-day >> /var/log/nispd/partner-reward.log 2>&1
    # Выставление счетов партнерам
    ###5 5 1 * *  flock -w 3 /tmp/yii-partner-reward-tobill /home/httpd/stat.mcn.ru/stat/yii partner-reward/rewards-to-bill >> /var/log/nispd/partner-reward-tobills.log 2>&1
    10 13 1 * * flock -w 3 /tmp/yii-partner-reward /home/httpd/stat.mcn.ru/stat/yii reward/calculate-all-partners "first day of previous month" >> /var/log/nispd/partner-reward.log 2>&1
    10 8 * * * flock -w 3 /tmp/yii-partner-reward /home/httpd/stat.mcn.ru/stat/yii reward/calculate-all-partners "yesterday" >> /var/log/nispd/partner-reward.log 2>&1
    
    # Mailer
    * * * * * flock -w 3 /tmp/yii-mailer /home/httpd/stat.mcn.ru/mailer/yii mail/mail >> /var/log/nispd/mailer.log 2>&1
    
    # Node.JS
    * * * * * cd /home/httpd/stat.mcn.ru/comet-server/; flock -w 3 /tmp/comet-server timeout 6h node index >> /var/log/nispd/comet.log 2>> /var/log/nispd/comet.err
    * * * * * cd /home/httpd/stat.mcn.ru/nnp-ported; flock -w 3 /tmp/nnp-ported node index >> /var/log/nispd/nnp-ported.log 2>> /var/log/nispd/nnp-ported.err
    
    # Очередь событий
    * * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; flock -w 3 /tmp/handler1 php ./handler.php with_account_tariff >> /var/log/nispd/handler_with_at.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; flock -w 3 /tmp/handler2 php ./handler.php without_account_tariff >> /var/log/nispd/handler_without_at.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; flock -w 3 /tmp/handler3 php ./handler.php ats3_sync >> /var/log/nispd/handler_without_at.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; flock -w 3 /tmp/handler4 php ./handler.php nnp >> /var/log/nispd/handler_nnp.log 2>&1
    
    # Health-монитор
    56 * * * * cd /home/httpd/stat.mcn.ru/stat; ./yii health/heavy >> /var/log/nispd/health.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/health; ./run.sh; cd ..; ./yii health/light >> /var/log/nispd/health.log 2>&1
    30 */6 * * * cd /home/httpd/stat.mcn.ru/stat/health; ./runRarely.sh;
    
    # event::go(midnight)
    0 0 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; php -c /etc/ event_midnight.php >> /var/log/nispd/cron_events.log
    
    # event::go(check_usages)
    1 * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; php -c /etc/ event_check_usages.php >> /var/log/nispd/cron_events.log
    
    # stat - обновление справочника БИК
    ####0 2 * * 1,3,5 cd /home/httpd/stat.mcn.ru/include/stat/utils/; php -c /etc/ bik_update.php get >> /var/log/nispd/cron_bik.log;  php -c /etc/ bik_update.php send >> /var/log/nispd/cron_bik.log; php -c /etc/ bik_update.php update >> /var/log/nispd/cron_bik.log;
    5 6 * * * /home/httpd/stat.mcn.ru/stat/yii currency/bik >> /var/log/nispd/bik.log
    
    
    
    # СОРМ. Сбор 7800 номеров
    10,20,40 * * * *  /home/httpd/stat.mcn.ru/stat/yii number/sorm7800 74 >> /var/log/nispd/sorm7800_74.log
    
    # Получение курсов валют
    50 */3 * * *  /home/httpd/stat.mcn.ru/stat/yii currency/import >> /var/log/nispd/cron_currency_import.log
    
    # LK - оправки сообщений о активации
    * * * * *  cd /home/httpd/stat.mcn.ru/include/stat/crons/notification/; flock -w 3 /tmp/yii-sender php -c /etc/ sender.php >> /var/log/nispd/cron_sender.log
    
    #выставление счетов. Отправка отчета.
    0 9 1 * *  cd /home/httpd/stat.mcn.ru/include/; ./yii biller/get-bill-report | sendmail adima123@yandex.ru
    #выставление счетов. Занести инвойсы в счетах зп прошлый месяц в книгу продаж
    #50 6 1 * *  cd /home/httpd/stat.mcn.ru/include/; ./yii biller/make-invoices
    
    
    #отложенные задания
    * * * * *  cd /home/httpd/stat.mcn.ru/include/; flock -w 3 /tmp/yii-deferred-task ./yii deferred-task/process >> /var/log/nispd/deferred-task.log
    
    #roistat. Заполнение цен.
    15 7 * * *  cd /home/httpd/stat.mcn.ru/include/; flock -w 3 /tmp/yii-fill-roistat-price ./yii uu/converter/account-tariff/fill-roistat-price >> /var/log/nispd/fill-roistat-price.log
  
    #проверяем, что все пакеты телефонии включены.
    */5 * 2-31 * *  cd /home/httpd/stat.mcn.ru/include/; flock -w 3 /tmp/yii-usage-check-voip-delay ./yii usage/check-voip-delay >> /var/log/nispd/usage-check-voip-delay.log
  
    # копируем "важные события" в clickhouse
    */3 * * * * flock -w 3 /tmp/mysql_clickhouse_copier /bin/python /home/httpd/stat.mcn.ru/stat/stat/crons/events/mysql_clickhouse_copier.py ee86a024319672991131 Sdfwe342 >> /var/log/nispd/mysql_clickhouse_copier.py
    
    # Импорт портированных номеров
    30 6 * * * cd /home/httpd/stat.mcn.ru/stat/; flock -w 3 /tmp/yii-nnp_ported_numbers ./yii nnp/ported-russia/update-ported-numbers >> /var/log/nispd/nnp_ported_numberLog.log 2>&1
    
    #sbis
    * * * * * flock -w 3 /tmp/yii-sbis-processor-sign /home/httpd/stat.mcn.ru/stat/yii sbisTenzor/processor/sign >>   /var/log/nispd/sbis/processor-sign.log
    * * * * * flock -w 3 /tmp/yii-sbis-processor-send /home/httpd/stat.mcn.ru/stat/yii sbisTenzor/processor/send >>   /var/log/nispd/sbis/processor-sender.log
    * * * * * flock -w 3 /tmp/yii-sbis-processor-check /home/httpd/stat.mcn.ru/stat/yii sbisTenzor/processor/check >> /var/log/nispd/sbis/processor-check.log
    * * * * * flock -w 3 /tmp/yii-sbis-processor-generate /home/httpd/stat.mcn.ru/stat/yii sbisTenzor/processor/generate >> /var/log/nispd/sbis/processor-generate.log
    0 12 1 * * flock -w 3 /tmp/yii-sbis-contractor-update /home/httpd/stat.mcn.ru/stat/yii sbisTenzor/contractor/update >> /var/log/nispd/sbis/contractor-update.log
    
    ### SIM registry 
    * * * * * flock -w 3 /tmp/yii-sim-registry-process /home/httpd/stat.mcn.ru/stat/yii sim/registry/process >> /var/log/nispd/sim_registry.log
  
    ###0 * * * * php ~/mysql_hung_request_killer.php >> /var/log/nispd/mysql_hung_request_killer.log


  crontab.file.eu: |

    # Очередь событий
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler1 php ./handler.php with_account_tariff >> /var/log/nispd/handler.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler2 php ./handler.php without_account_tariff >> /var/log/nispd/handler.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler3 php ./handler.php ats3_sync >> /var/log/nispd/handler.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler5 php ./handler.php kafka >> /var/log/nispd/handler.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler7 php ./handler.php kafka2 >> /var/log/nispd/handler.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler6 php ./handler.php uu_sync >> /var/log/nispd/handler.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock --nonblock /var/run/handler4 php ./handler.php nnp >> /var/log/nispd/handler.log 2>&1
    
    # Сообщения из kafka
    * * * * * flock --nonblock /var/run/yii-listen-contragent-changes /home/httpd/stat.mcn.ru/stat/yii contragent/listen-changes   >> /var/log/nispd/handler.log 2>&1
    * * * * * flock --nonblock /var/run/yii-listen-event-bus          /home/httpd/stat.mcn.ru/stat/yii event-bus/listen            >> /var/log/nispd/handler.log 2>&1
    * * * * * flock --nonblock /var/run/yii-listen-ai-dialogs         /home/httpd/stat.mcn.ru/stat/yii biller/listen-ai-dialog-raw >> /var/log/nispd/handler.log 2>&1
        
    # Универсальные услуги
    10 0-5,12-23 * * * flock --nonblock /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log 2>&1
    0 * * * * flock --nonblock /tmp/yii-ubiller-announce-resource-changes /home/httpd/stat.mcn.ru/stat/yii ubiller/announce-resource-changes >> /var/log/nispd/ubiller.log 2>&1

    ### Обновление lock'ов
    * * * * * flock --nonblock /var/run/yii-update-locks /home/httpd/stat.mcn.ru/stat/yii biller/update-locks >> /var/log/nispd/biller-update-locks.log
    * * * * * flock --nonblock /var/run/yii-sync-client-change /home/httpd/stat.mcn.ru/stat/yii notify/client-structure-changed >> /var/log/nispd/handler.log 2>&1
    
    10 2 * * * /home/httpd/stat.mcn.ru/stat/yii usage/client-update-is-active
    1 0 * * *  /home/httpd/stat.mcn.ru/stat/yii number/release-from-hold >> /var/log/nispd/release-from-hold.log
    2 0 * * *  /home/httpd/stat.mcn.ru/stat/yii number/actualize-numbers-by-usages >> /var/log/nispd/actualize-numbers-by-usages.log
    2 5 * * *  /home/httpd/stat.mcn.ru/stat/yii number/actualize-released 1 >> /var/log/nispd/actualize-numbers-released.log
    
    0 0 * * * flock --nonblock /tmp/yii-version-export /home/httpd/stat.mcn.ru/stat/yii version/export-current-versions >> /var/log/nispd/version-export.log
    1 0-3,15-23 * * * flock --nonblock /tmp/yii-usage-check-bill-overdue /home/httpd/stat.mcn.ru/stat/yii usage/check-bill-overdue >> /var/log/nispd/usage-check-bill-overdue.log
    59 20 * * *  /home/httpd/stat.mcn.ru/stat/yii usage/voip-test-clean >> /var/log/nispd/voip-test-clean.log
    0 4 * * * flock --nonblock /tmp/lk-set-is-lk-exists /home/httpd/stat.mcn.ru/stat/yii lk/set-is-lk-exists >> /var/log/nispd/lk-set-is-lk-exists.log
    0 * * * * flock --nonblock /tmp/number-actual-hourly /home/httpd/stat.mcn.ru/stat/yii number/actual-hourly >> /var/log/nispd/number-actual-hourly
    3 3 * * * flock --nonblock /tmp/number-actual-status-all /home/httpd/stat.mcn.ru/stat/yii number/actual-status-all 1 >> /var/log/nispd/number-actual-status-all
  
    */3 * * * *  flock --nonblock /tmp/yii-check-voip-day-disable /home/httpd/stat.mcn.ru/stat/yii usage/check-voip-day-disable >> /var/log/nispd/check-voip-day-disable.log
    #*/3 * * * *  flock --nonblock /tmp/yii-check-notification /home/httpd/stat.mcn.ru/stat/yii lk/check-notification >> /var/log/nispd/check-notification.log

    # Расчет партнерского вознаграждения
    10 13 1 * * flock --nonblock /tmp/yii-partner-reward /home/httpd/stat.mcn.ru/stat/yii reward/calculate-all-partners "first day of previous month" >> /var/log/nispd/partner-reward.log 2>&1
    10 8 * * * flock --nonblock /tmp/yii-partner-reward /home/httpd/stat.mcn.ru/stat/yii reward/calculate-all-partners "yesterday" >> /var/log/nispd/partner-reward.log 2>&1
    
    ####! включить после решения проблем с сервереом постгреса !###
    #*/5 * * * *  flock --nonblock /tmp/yii-update-interop-counter /home/httpd/stat.mcn.ru/stat/yii number/update-interop-counter >> /var/log/nispd/update-interop-counter.log
    
    * * * * *  flock --nonblock /tmp/yii-tt-check-trouble-count-recal /home/httpd/stat.mcn.ru/stat/yii ticket/check-trouble-count-recal >> /var/log/nispd/tt-check-trouble-count-recal.log
    
    # прогнозирование блокировки по счету
    # 9 15 21-31 * *  flock --nonblock /tmp/yii-biller-forecast-account-block /home/httpd/stat.mcn.ru/stat/yii biller/forecast-account-block >> /var/log/nispd/forecast-account-block.log 2>&1
    
    # 3 0 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/voip; php -c /etc/ voipcheck.php >> /var/log/nispd/voipcheck.log
    # 0 5 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/voip; php -c /etc/ voipcheck.php >> /var/log/nispd/voipcheck.log
    
    5 3 * * * flock --nonblock /tmp/yii-number_calc-calls-per-month-0 /home/httpd/stat.mcn.ru/stat/yii number/calc-calls-per-month-0 >> /var/log/nispd/number-calls-per-month.log
    5 4 1 * * flock --nonblock /tmp/yii-number_calc-calls-per-month   /home/httpd/stat.mcn.ru/stat/yii number/calc-calls-per-month   >> /var/log/nispd/number-calls-per-month.log
    
    # Счетчики статистики
    2 0 2-31 * * flock --nonblock /tmp/yii-statistic-update /home/httpd/stat.mcn.ru/stat/yii statistic/update yesterday >> /var/log/nispd/stat-update.log
    2 0 1 * *    flock --nonblock /tmp/yii-statistic-update /home/httpd/stat.mcn.ru/stat/yii statistic/update prevmonth >> /var/log/nispd/stat-update.log
    
    
    # Заполнение calls_raw_cache
    20 4 * * *  flock --nonblock /tmp/yii-calls_raw_cache /home/httpd/stat.mcn.ru/stat/yii calls-raw-cache/make-cache >> /var/log/nispd/calls_raw_cache.log
    25 5 * * * flock --nonblock /tmp/yii-calls-raw-unite /home/httpd/stat.mcn.ru/stat/yii calls-raw-unite/make-unite >> /var/log/nispd/calls_raw_unite.log
    
    #0 6 * * * flock --nonblock /tmp/yii-nnp2-renew /home/httpd/stat.mcn.ru/stat/yii nnp2/range-short/renew >> /var/log/nispd/nnp2-renew.log
    
    # Перезабор данных о потребленных ресурсов с ВАТС.
    0 5 1 * * flock --nonblock /tmp/yii-vpbx-stat-get /home/httpd/stat.mcn.ru/stat/yii stat/vats/get prevmonth >> /var/log/nispd/vats-stat-prevmonth.log 2>&1
    10 5 * * *  /home/httpd/stat.mcn.ru/stat/yii stat/vats/get yesterday >> /var/log/nispd/cron_vats_stat.log
    10 15 * * *  /home/httpd/stat.mcn.ru/stat/yii stat/vats/get yesterday >> /var/log/nispd/cron_vats_stat.log
    
    # обновление таблицы uu_account_tariff_voip_flat
    0 4 * * * /home/httpd/stat.mcn.ru/stat/yii uu/account-tariff-voip-flat/generate
    
    */3 * * * *    cd /home/httpd/stat.mcn.ru/stat/stat/; flock --nonblock /var/run/automail php automail.php >> /var/log/nispd/handler.log 2>&1
    
    # Универсальные услуги
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1 200000 >> /var/log/nispd/ubiller.log.11
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 200001 300000 >> /var/log/nispd/ubiller.log.12
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 300001 400000 >> /var/log/nispd/ubiller.log.13
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 400001 500000 >> /var/log/nispd/ubiller.log.14
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 500001 600000 >> /var/log/nispd/ubiller.log.15
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 600001 700000 >> /var/log/nispd/ubiller.log.16
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 700001 800000 >> /var/log/nispd/ubiller.log.17
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 800001 900000 >> /var/log/nispd/ubiller.log.18
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 900001 1000000 >> /var/log/nispd/ubiller.log.19
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1000001 1100000 >> /var/log/nispd/ubiller.log.20
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1100001 1200000 >> /var/log/nispd/ubiller.log.21
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1200001 1300000 >> /var/log/nispd/ubiller.log.22
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1300001 1400000 >> /var/log/nispd/ubiller.log.23
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1400001 1500000 >> /var/log/nispd/ubiller.log.24
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1500001 1600000 >> /var/log/nispd/ubiller.log.25
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1600001 1700000 >> /var/log/nispd/ubiller.log.25
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1700001 1800000 >> /var/log/nispd/ubiller.log.25
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1800001 1900000 >> /var/log/nispd/ubiller.log.25
    #2 23 28-31 * * flock -w 3 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/period 1900001 2000000 >> /var/log/nispd/ubiller.log.25
    #3 23 28-31 * * flock -w 8000 /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log
    
    
    #29 5 * * *                                   /home/httpd/stat.mcn.ru/stat/yii param/set stop_ubiller_flag 1 >> /var/log/nispd/ubiller.log
    #29 5 * * *                                   /home/httpd/stat.mcn.ru/stat/yii ubiller/prepare-resource-calc 15 >> /var/log/nispd/ubiller.log
    #29 5 * * * flock -w 3    -x /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/set-and-sync-tariff >> /var/log/nispd/ubiller.log
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p1 >> /var/log/nispd/ubiller.log.11
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p2 >> /var/log/nispd/ubiller.log.12
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p3 >> /var/log/nispd/ubiller.log.13
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p4 >> /var/log/nispd/ubiller.log.14
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p5 >> /var/log/nispd/ubiller.log.15
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p6 >> /var/log/nispd/ubiller.log.16
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p7 >> /var/log/nispd/ubiller.log.17
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p8 >> /var/log/nispd/ubiller.log.18
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p9 >> /var/log/nispd/ubiller.log.19
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p10 >> /var/log/nispd/ubiller.log.20
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p11 >> /var/log/nispd/ubiller.log.21
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p12 >> /var/log/nispd/ubiller.log.22
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p13 >> /var/log/nispd/ubiller.log.23
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p14 >> /var/log/nispd/ubiller.log.24
    #30 5 * * * flock -w 4000 -s /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller/resource p15 >> /var/log/nispd/ubiller.log.25
    #31 5 * * * flock -w 8000 -x /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log
    
    5 6 2 * * time flock /tmp/yii-ubiller        /home/httpd/stat.mcn.ru/stat/yii ubiller/clean-up >> /var/log/nispd/ubiller.log
    1 0 * * * time flock --nonblock /tmp/yii-ubiller-margin /home/httpd/stat.mcn.ru/stat/yii ubiller/fill-margins >> /var/log/nispd/margin.log 2>&1

    # Экспорт free-numbers
    #44 * * * * cd /home/httpd/stat.mcn.ru/stat/modules/freeNumber; ./export.sh
    
    # Mailer
    #* * * * * flock --nonblock /tmp/yii-mailer /home/httpd/stat.mcn.ru/mailer/yii mail/mail >> /var/log/nispd/mailer.log 2>&1
    
    # Health-монитор
    #56 * * * * cd /home/httpd/stat.mcn.ru/stat; ./yii health/heavy >> /var/log/nispd/health.log 2>&1
    #* * * * * cd /home/httpd/stat.mcn.ru/stat/health; ./run.sh; cd ..; ./yii health/light >> /var/log/nispd/health.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/; ./yii health/light >> /var/log/nispd/health.log 2>&1
    #30 */6 * * * cd /home/httpd/stat.mcn.ru/stat/health; ./runRarely.sh;
    
    # event::go(midnight)
    0 0 * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; php -c /etc/ event_midnight.php >> /var/log/nispd/cron_events.log
    
    # event::go(check_usages)
    1 * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/events/; php -c /etc/ event_check_usages.php >> /var/log/nispd/cron_events.log
    
    # Получение курсов валют
    50 */3 * * * /home/httpd/stat.mcn.ru/stat/yii currency/import >> /var/log/nispd/cron_currency_import.log
    
    # LK - оправки сообщений о активации
    #* * * * * cd /home/httpd/stat.mcn.ru/include/stat/crons/notification/; flock -w 3 /tmp/yii-sender php -c /etc/ sender.php >> /var/log/nispd/cron_sender.log
    
    #проверяем, что все пакеты телефонии включены.
    */5 * 2-31 * * cd /home/httpd/stat.mcn.ru/include/; flock --nonblock /tmp/yii-usage-check-voip-delay ./yii usage/check-voip-delay >> /var/log/nispd/usage-check-voip-delay.log
  
    #### heavy task manager
    * * * * * flock --nonblock /var/run/yii-task /home/httpd/stat.mcn.ru/stat/yii task >> /var/log/nispd/task.log
    
    #### sync client change
    * * * * * flock --nonblock /var/run/yii-sync-client-change /home/httpd/stat.mcn.ru/stat/yii notify/client-structure-changed >> /var/log/nispd/handler.log

  crontab.file.dev: |
    # Очередь событий
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock -w 3 /var/run/handler1 php ./handler.php with_account_tariff >> /var/log/nispd/handler_with_at.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock -w 3 /var/run/handler2 php ./handler.php without_account_tariff >> /var/log/nispd/handler_without_at.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock -w 3 /var/run/handler3 php ./handler.php ats3_sync >> /var/log/nispd/handler_without_at.log 2>&1
    * * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; flock -w 3 /var/run/handler4 php ./handler.php nnp >> /var/log/nispd/handler_nnp.log 2>&1
    
    # event::go(midnight)
    0 0 * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; php -c /etc/ event_midnight.php >> /var/log/nispd/cron_events.log
    
    # event::go(check_usages)
    1 * * * * cd /home/httpd/stat.mcn.ru/stat/stat/crons/events/; php -c /etc/ event_check_usages.php >> /var/log/nispd/cron_events.log

    # Универсальные услуги
    #10 0-5,15-23 * * * flock -w 3 /tmp/yii-ubiller /home/httpd/stat.mcn.ru/stat/yii ubiller >> /var/log/nispd/ubiller.log 2>&1
